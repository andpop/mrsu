**********************
PowerShell transcript start
Start time: 20230116101349
**********************
Transcript started, output file is log.txt
303_Akajkin_SV
303_Akimova_DA
303_Artamonov_AV
303_Bugreeva_AM
303_Denisov_RV
303_Fedin_DA
303_Kaderov_RO
303_Kochetkov_PA
303_Makarova_AJ
303_Meljakin_EV
303_Melkonjan_MA
303_Negrja_MJ
303_Nikishkin_EV
303_Nujanzin_MA
303_Pomelova_AS
303_Prokopenko_AS
303_Prokopenko_DS
303_Rjabikin_KS
303_Rodkin_AV
303_Timovkin_AJ
303_Turaev_DV
303_Venediktova_JP
303_Zinkina_KV
=====================================================
/home/andrey/labs/303/303_Zinkina_KV
Из github.com-mrsu:andpop-mrsu/303_Zinkina_KV
Из github.com-mrsu:andpop-mrsu/303_Zinkina_KV
 * branch            master     -> FETCH_HEAD
 * branch            master     -> FETCH_HEAD
Уже актуально.
fatal: внешний репозиторий student уже существует
fatal: внешний репозиторий student уже существует
Уже актуально.
Task from branch: Task08
Creation date: 12/30/2022 09:53:20
Checking script check_Task08.ps1 not found
=====================================================
/home/andrey/labs/303/303_Zinkina_KV
Из github.com-mrsu:andpop-mrsu/303_Zinkina_KV
Из github.com-mrsu:andpop-mrsu/303_Zinkina_KV
 * branch            master     -> FETCH_HEAD
 * branch            master     -> FETCH_HEAD
Уже актуально.
fatal: внешний репозиторий student уже существует
fatal: внешний репозиторий student уже существует
Уже актуально.
--------------------------------------------------
Task:  /home/andrey/labs/303/303_Zinkina_KV/Task07
--------------------------------------------------
Check path: task7_cli.php
--------------------------------------------------
Check path: index.php
--------------------------------------------------
Total ok: 2
Total error: 0
--------------------------------------------------
/home/andrey/labs/303/303_Zinkina_KV
Task07
Task from branch: Task07
Creation date: 12/30/2022 09:51:57
To github.com-mrsu:andpop-mrsu/303_Zinkina_KV.git
To github.com-mrsu:andpop-mrsu/303_Zinkina_KV.git
   f39ecbf..82a0380  master -> master
   f39ecbf..82a0380  master -> master
=====================================================
/home/andrey/labs/303/303_Zinkina_KV
Из github.com-mrsu:andpop-mrsu/303_Zinkina_KV
Из github.com-mrsu:andpop-mrsu/303_Zinkina_KV
 * branch            master     -> FETCH_HEAD
 * branch            master     -> FETCH_HEAD
Уже актуально.
fatal: внешний репозиторий student уже существует
fatal: внешний репозиторий student уже существует
Уже актуально.
--------------------------------------------------
Task:  /home/andrey/labs/303/303_Zinkina_KV/Task06
--------------------------------------------------
Check path: db_init.sql
--------------------------------------------------
Check path: ER.jpg
--------------------------------------------------
Check path: db_schema.jpg
--------------------------------------------------
Total ok: 3
Total error: 0
--------------------------------------------------
/home/andrey/labs/303/303_Zinkina_KV
Task06
Task from branch: Task06
Creation date: 12/30/2022 09:47:18
Everything up-to-date
Everything up-to-date
=====================================================
/home/andrey/labs/303/303_Zinkina_KV
Из github.com-mrsu:andpop-mrsu/303_Zinkina_KV
Из github.com-mrsu:andpop-mrsu/303_Zinkina_KV
 * branch            master     -> FETCH_HEAD
 * branch            master     -> FETCH_HEAD
Уже актуально.
fatal: внешний репозиторий student уже существует
fatal: внешний репозиторий student уже существует
Уже актуально.
--------------------------------------------------
Task:  /home/andrey/labs/303/303_Zinkina_KV/Task05
--------------------------------------------------
Check path: db_init.sql
--------------------------------------------------
Check path: data_add.sql
data_add.sql not found
--------------------------------------------------
Check path: db_schema.jpg
db_schema.jpg not found
--------------------------------------------------
Run: sqlite3 test.db .read db_init.sql

Execution fails
--------------------------------------------------
Run: sqlite3 test.db select count(*) from users
943
--------------------------------------------------
Total ok: 2
Total error: 3
--------------------------------------------------
/home/andrey/labs/303/303_Zinkina_KV
Task05
Task from branch: Task05
Creation date: 12/30/2022 09:45:07
Everything up-to-date
Everything up-to-date
=====================================================
/home/andrey/labs/303/303_Zinkina_KV
Из github.com-mrsu:andpop-mrsu/303_Zinkina_KV
Из github.com-mrsu:andpop-mrsu/303_Zinkina_KV
 * branch            master     -> FETCH_HEAD
 * branch            master     -> FETCH_HEAD
Уже актуально.
fatal: внешний репозиторий student уже существует
fatal: внешний репозиторий student уже существует
Уже актуально.
--------------------------------------------------
Task:  /home/andrey/labs/303/303_Zinkina_KV/Task04
--------------------------------------------------
Check path: db_init.sql
--------------------------------------------------
Check path: task4.bat
#!/bin/bash
chcp 65001

sqlite3 movies_rating.db < db_init.sql

echo "1. Найти все пары пользователей, оценивших один и тот же фильм. Устранить дубликаты, проверить отсутствие пар с самим собой. Для каждой пары должны быть указаны имена пользователей и название фильма, который они ценили."
echo --------------------------------------------------
sqlite3 movies_rating.db -box -echo "SELECT DISTINCT MIN(v1.name, v2.name) reviewer1, MAX(v1.name, v2.name) reviewer2, mov.title FROM movies m INNER JOIN ratings r1 ON r1.movie_id = m.id INNER JOIN ratings r2 ON r2.movie_id = m.id INNER JOIN movies mov ON mov.id = m.id INNER JOIN users v1 ON v1.id = r1.user_id INNER JOIN users v2 ON v2.id = r2.user_id WHERE (v1.id <> v2.id) ORDER BY reviewer1, reviewer2, mov.title;"
echo " "

echo "2. Найти 10 самых свежих оценок от разных пользователей, вывести названия фильмов, имена пользователей, оценку, дату отзыва в формате ГГГГ-ММ-ДД."
echo --------------------------------------------------
sqlite3 movies_rating.db -box -echo "SELECT us.name, mov.title, rat.rating, DATE(rat.timestamp, 'unixepoch') as date FROM ratings r INNER JOIN users us ON us.id = r.user_id INNER JOIN movies mov ON mov.id = r.movie_id INNER JOIN ratings rat ON rat.id = r.id ORDER BY rat.timestamp DESC LIMIT 10;"
echo " "

echo "3. Вывести в одном списке все фильмы с максимальным средним рейтингом и все фильмы с минимальным средним рейтингом. Общий список отсортировать по году выпуска и названию фильма. В зависимости от рейтинга в колонке "Рекомендуем" для фильмов должно быть написано "Да" или "Нет"."
echo --------------------------------------------------
sqlite3 movies_rating.db -box -echo "SELECT title, year, recs.rating AS rating, recs.recommendation AS Рекомендуем FROM movies INNER JOIN (SELECT avg_vals.movie_id AS movie_id, avg_vals.mid_val AS rating, CASE avg_vals.mid_val WHEN max_and_min.max_val THEN 'Да' WHEN max_and_min.min_val THEN'Нет' END 'recommendation' FROM (SELECT movie_id, avg(rating) AS mid_val FROM ratings GROUP BY movie_id) avg_vals  INNER JOIN (SELECT max(mid_val) AS max_val, min(mid_val) AS min_val FROM (SELECT movie_id, avg(rating) AS mid_val FROM ratings GROUP BY movie_id)) max_and_min ON avg_vals.mid_val==max_and_min.max_val OR avg_vals.mid_val==max_and_min.min_val) recs ON movies.id==movie_id ORDER BY year, title;"
echo " "

echo "4. Вычислить количество оценок и среднюю оценку, которую дали фильмам пользователи-женщины в период с 2010 по 2012 год."
echo --------------------------------------------------
sqlite3 movies_rating.db -box -echo "SELECT COUNT(marks.rating) as count_of_marks, AVG(marks.rating) as average FROM (SELECT r.rating FROM ratings as r INNER JOIN users user ON user.id = r.user_id WHERE user.gender = 'female' AND r.timestamp > 1262303999 AND r.timestamp < 1325376000) AS marks;"
echo " "

echo "5. Составить список фильмов с указанием их средней оценки и места в рейтинге по средней оценке. Полученный список отсортировать по году выпуска и названиям фильмов. В списке оставить первые 20 записей."
echo --------------------------------------------------
sqlite3 movies_rating.db -box -echo "SELECT movies.title, movies.year, average_rating.avg_rating, row_number() OVER (ORDER BY average_rating.avg_rating DESC) rating_place FROM movies INNER JOIN (SELECT movie_id, AVG(rating) AS avg_rating FROM ratings GROUP BY movie_id) AS average_rating ON average_rating.movie_id = movies.id ORDER BY movies.year, movies.title LIMIT 20;"
echo " "

echo "6. Вывести список из 10 последних зарегистрированных пользователей в формате "Фамилия Имя|Дата регистрации" (сначала фамилия, потом имя)."
echo --------------------------------------------------
sqlite3 movies_rating.db -box -echo "SELECT SUBSTR(users.name, instr(users.name, ' ') + 1) ||  '  ' ||  SUBSTR(users.name, 0, INSTR(users.name, ' '))  ||  '|' ||  users.register_date AS 'Фамилия Имя|Дата регистрации' FROM users ORDER BY users.register_date DESC LIMIT 10;"
echo " "

echo "7. С помощью рекурсивного CTE составить таблицу умножения для чисел от 1 до 10. Должен получиться один столбец следующего вида:
1x1=1
1x2=2
. . .
1x10=10
2x1=2
2x2=2
. . .
10x9=90
10x10=100"
echo --------------------------------------------------
sqlite3 movies_rating.db -box -echo "WITH RECURSIVE tab(x, y) AS (SELECT 1, 1 UNION All SELECT x + (y)/10, (y + 0) % 10 + 1 FROM tab WHERE x <= 10) SELECT tab.x || 'x' || tab.y || ' = ' || format(tab.x*tab.y) AS tab FROM tab WHERE tab.x <= 10;"
echo " "

echo "8. С помощью рекурсивного CTE выделить все жанры фильмов, имеющиеся в таблице movies (каждый жанр в отдельной строке)."
echo --------------------------------------------------
sqlite3 movies_rating.db -box -echo "WITH genres_array(r_lenght, r_part, res) AS (SELECT 1, movies.genres||'|', '' FROM movies WHERE 1 UNION ALL SELECT instr(r_part, '|' ) AS r_l, substr(r_part, instr(r_part, '|' ) + 1), substr(r_part, 1, instr(r_part, '|' ) - 1) FROM genres_array WHERE r_l > 0) SELECT DISTINCT res AS 'Genres' FROM genres_array WHERE length(res) > 0;"
echo " "
pause
--------------------------------------------------
Run: ./task4.bat
PS>TerminatingError(): "Cannot run a document in the middle of a pipeline: /home/andrey/labs/303/303_Zinkina_KV/Task04/task4.bat."

InvalidOperation: /home/andrey/projects/mrsu/02_DB/tools/check_tasks/checks_for_task.ps1:32
Line |
  32 |      $str = (& $command $params | Out-String)
     |              ~~~~~~~~~~~~~~~~~~
     | Cannot run a document in the middle of a pipeline: /home/andrey/labs/303/303_Zinkina_KV/Task04/task4.bat.

InvalidOperation: /home/andrey/projects/mrsu/02_DB/tools/check_tasks/checks_for_task.ps1:32
Line |
  32 |      $str = (& $command $params | Out-String)
     |              ~~~~~~~~~~~~~~~~~~
     | Cannot run a document in the middle of a pipeline: /home/andrey/labs/303/303_Zinkina_KV/Task04/task4.bat.


Execution fails
--------------------------------------------------
Total ok: 2
Total error: 1
--------------------------------------------------
/home/andrey/labs/303/303_Zinkina_KV
Task04
Task from branch: Task04
Creation date: 12/30/2022 09:39:18
Everything up-to-date
Everything up-to-date
=====================================================
/home/andrey/labs/303/303_Zinkina_KV
Из github.com-mrsu:andpop-mrsu/303_Zinkina_KV
Из github.com-mrsu:andpop-mrsu/303_Zinkina_KV
 * branch            master     -> FETCH_HEAD
 * branch            master     -> FETCH_HEAD
Уже актуально.
fatal: внешний репозиторий student уже существует
fatal: внешний репозиторий student уже существует
Уже актуально.
--------------------------------------------------
Task:  /home/andrey/labs/303/303_Zinkina_KV/Task03
--------------------------------------------------
Check path: db_init.sql
--------------------------------------------------
Check path: task3.bat
#!/bin/bash
chcp 65001

sqlite3 movies_rating.db < db_init.sql

echo "1. Составить список фильмов, имеющих хотя бы одну оценку. Список фильмов отсортировать по году выпуска и по названиям. В списке оставить первые 10 фильмов."
echo --------------------------------------------------
sqlite3 movies_rating.db -box -echo "SELECT title FROM ratings INNER JOIN movies on movies.id = ratings.movie_id and year NOT NULL GROUP BY title HAVING count(movie_id) ORDER BY year,title LIMIT 10;"
echo ""

echo "2.Вывести список всех пользователей, фамилии (не имена!) которых начинаются на букву 'A'. Полученный список отсортировать по дате регистрации. В списке оставить первых 5 пользователей."
echo --------------------------------------------------
sqlite3 movies_rating.db -box -echo "SELECT name FROM users WHERE SUBSTRING(name ,instr(name,' ')+1) LIKE 'A%' ORDER BY register_date LIMIT 5;"
echo ""

echo "3.Написать запрос, возвращающий информацию о рейтингах в более читаемом формате: имя и фамилия эксперта, название фильма, год выпуска, оценка и дата оценки в формате ГГГГ-ММ-ДД. Отсортировать данные по имени эксперта, затем названию фильма и оценке. В списке оставить первые 50 записей."
echo --------------------------------------------------
sqlite3 movies_rating.db -box -echo "SELECT name, title, year, rating, date(timestamp, 'unixepoch') AS date FROM users INNER JOIN ratings ON users.id=ratings.user_id INNER JOIN movies ON ratings.movie_id=movies.id ORDER BY substr(name, 1, instr(name, ' ')-1), title, rating LIMIT 50;"
echo ""

echo "4.Вывести список фильмов с указанием тегов, которые были им присвоены пользователями. Сортировать по году выпуска, затем по названию фильма, затем по тегу. В списке оставить первые 40 записей."
echo --------------------------------------------------
sqlite3 movies_rating.db -box -echo "SELECT title,tag FROM tags INNER JOIN movies on tags.movie_id = movies.id WHERE year NOT NULL ORDER BY year,title,tag LIMIT 40;"
echo ""

echo "5.Вывести список самых свежих фильмов. В список должны войти все фильмы последнего года выпуска, имеющиеся в базе данных. Запрос должен быть универсальным, не зависящим от исходных данных (нужный год выпуска должен определяться в запросе, а не жестко задаваться)"
echo --------------------------------------------------
sqlite3 movies_rating.db -box -echo "SELECT title FROM movies WHERE year=(SELECT max(year) FROM movies);"
echo ""

echo "6.Найти все комедии, выпущенные после 2000 года, которые понравились мужчинам (оценка не ниже 4.5). Для каждого фильма в этом списке вывести название, год выпуска и количество таких оценок. Результат отсортировать по году выпуска и названию фильма."
echo --------------------------------------------------
sqlite3 movies_rating.db -box -echo "SELECT comedy.title,comedy.year,count(comedy.title) as num_rating FROM ratings INNER JOIN (SELECT title,id,year FROM movies WHERE genres LIKE '%Comedy%' AND year > 2000) comedy ON movie_id == comedy.id INNER JOIN users ON ratings.user_id = users.id WHERE gender == 'male' GROUP BY comedy.title ORDER BY comedy.year,comedy.title;"
echo ""

echo "7.Провести анализ занятий (профессий) пользователей - вывести количество пользователей для каждого рода занятий. Найти самую распространенную и самую редкую профессию посетитетей сайта."
echo --------------------------------------------------
sqlite3 movies_rating.db -box -echo "SELECT users.occupation,count(users.occupation) as num_occupation FROM users GROUP BY occupation;"
echo ""

echo "7.1 Самая редкая профессия"
sqlite3 movies_rating.db -box -echo "SELECT occupation,min(num_occupation) as r_prof FROM (SELECT users.occupation,count(users.occupation) as num_occupation FROM users GROUP BY occupation);"
echo ""

echo "7.2 Самая распространённая профессия"
sqlite3 movies_rating.db -box -echo "SELECT occupation,max(number_occupation) as most_com_prof FROM (SELECT users.occupation,count(users.occupation) as number_occupation FROM users GROUP BY occupation);"
echo ""
--------------------------------------------------
Run: ./task3.bat
PS>TerminatingError(): "Cannot run a document in the middle of a pipeline: /home/andrey/labs/303/303_Zinkina_KV/Task03/task3.bat."

InvalidOperation: /home/andrey/projects/mrsu/02_DB/tools/check_tasks/checks_for_task.ps1:32
Line |
  32 |      $str = (& $command $params | Out-String)
     |              ~~~~~~~~~~~~~~~~~~
     | Cannot run a document in the middle of a pipeline: /home/andrey/labs/303/303_Zinkina_KV/Task03/task3.bat.

InvalidOperation: /home/andrey/projects/mrsu/02_DB/tools/check_tasks/checks_for_task.ps1:32
Line |
  32 |      $str = (& $command $params | Out-String)
     |              ~~~~~~~~~~~~~~~~~~
     | Cannot run a document in the middle of a pipeline: /home/andrey/labs/303/303_Zinkina_KV/Task03/task3.bat.


Execution fails
--------------------------------------------------
Total ok: 2
Total error: 1
--------------------------------------------------
/home/andrey/labs/303/303_Zinkina_KV
Task03
Task from branch: Task03
Creation date: 12/30/2022 09:27:31
Everything up-to-date
Everything up-to-date
=====================================================
/home/andrey/labs/303/303_Zinkina_KV
Из github.com-mrsu:andpop-mrsu/303_Zinkina_KV
Из github.com-mrsu:andpop-mrsu/303_Zinkina_KV
 * branch            master     -> FETCH_HEAD
 * branch            master     -> FETCH_HEAD
Уже актуально.
fatal: внешний репозиторий student уже существует
fatal: внешний репозиторий student уже существует
Уже актуально.
--------------------------------------------------
Task:  /home/andrey/labs/303/303_Zinkina_KV/Task02
--------------------------------------------------
Check path: db_init.bat
#!/bin/bash
python3 make_db_init.py
sqlite3 movies_rating.db < db_init.sql
--------------------------------------------------
Check path: README.md
- На компьютере должны быть установлены sqlite3, python3;
- db_init.bat создаст db_init.sql
- При успешком выополнении предыдущего действия создастся база данных
--------------------------------------------------
Run: ./db_init.bat
PS>TerminatingError(): "Cannot run a document in the middle of a pipeline: /home/andrey/labs/303/303_Zinkina_KV/Task02/db_init.bat."

InvalidOperation: /home/andrey/projects/mrsu/02_DB/tools/check_tasks/checks_for_task.ps1:32
Line |
  32 |      $str = (& $command $params | Out-String)
     |              ~~~~~~~~~~~~~~~~~~
     | Cannot run a document in the middle of a pipeline: /home/andrey/labs/303/303_Zinkina_KV/Task02/db_init.bat.

InvalidOperation: /home/andrey/projects/mrsu/02_DB/tools/check_tasks/checks_for_task.ps1:32
Line |
  32 |      $str = (& $command $params | Out-String)
     |              ~~~~~~~~~~~~~~~~~~
     | Cannot run a document in the middle of a pipeline: /home/andrey/labs/303/303_Zinkina_KV/Task02/db_init.bat.


Execution fails
False
--------------------------------------------------
Check path: movies_rating.db
Count records in movies:
Error: in prepare, no such table: movies
Error: in prepare, no such table: movies
Count records in ratings:
Error: in prepare, no such table: ratings
Error: in prepare, no such table: ratings
Count records in tags:
Error: in prepare, no such table: tags
Error: in prepare, no such table: tags
Count records in users:
Error: in prepare, no such table: users
Error: in prepare, no such table: users
--------------------------------------------------
Total ok: 3
Total error: 0
--------------------------------------------------
/home/andrey/labs/303/303_Zinkina_KV
Task02
Task from branch: Task02
Creation date: 12/30/2022 09:25:49
**********************
PowerShell transcript end
End time: 20230116101459
**********************
