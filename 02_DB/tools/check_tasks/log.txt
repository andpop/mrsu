**********************
PowerShell transcript start
Start time: 20251031115445
**********************
Transcript started, output file is log.txt
304_DB_Afonkin_DE
=====================================================
/home/andrey/labs/DB/304_DB_Afonkin_DE
Из github.com-mrsu:andpop-mrsu/304_DB_Afonkin_DE
Из github.com-mrsu:andpop-mrsu/304_DB_Afonkin_DE
 * branch            master     -> FETCH_HEAD
 * branch            master     -> FETCH_HEAD
Уже актуально.
fatal: внешний репозиторий student уже существует
fatal: внешний репозиторий student уже существует
Из https://github.com/bghtt/304_DB_Afonkin_DE
Из https://github.com/bghtt/304_DB_Afonkin_DE
 * [новая ветка]     Task04     -> student/Task04
 * [новая ветка]     Task04     -> student/Task04
Merge made by the 'recursive' strategy.
 Task04/db_init.sql | 33183 +++++++++++++++++++++++++++++++++++++++++++++++++++
 Task04/task4.bat   |   136 +
 2 files changed, 33319 insertions(+)
 create mode 100644 Task04/db_init.sql
 create mode 100755 Task04/task4.bat
--------------------------------------------------
Task:  /home/andrey/labs/DB/304_DB_Afonkin_DE/Task04
--------------------------------------------------
Check path: db_init.sql
--------------------------------------------------
Check path: task4.bat
#!/bin/bash
chcp 65001

sqlite3 movies_rating.db < db_init.sql

echo "1. Найти все пары пользователей, оценивших один и тот же фильм. Устранить дубликаты, исключить пары с самим собой. В списке оставить первые 100 записей."
echo --------------------------------------------------
sqlite3 movies_rating.db -box -echo "\
SELECT u1.name AS user1, u2.name AS user2, m.title AS movie\
FROM ratings r1\
JOIN ratings r2 ON r1.movie_id = r2.movie_id AND r1.user_id < r2.user_id\
JOIN users u1 ON u1.id = r1.user_id\
JOIN users u2 ON u2.id = r2.user_id\
JOIN movies m ON m.id = r1.movie_id\
ORDER BY m.title, user1, user2\
LIMIT 100;"
echo " "

echo "2. 10 самых свежих оценок от разных пользователей: фильм, пользователь, оценка, дата (ГГГГ-ММ-ДД)."
echo --------------------------------------------------
sqlite3 movies_rating.db -box -echo "\
WITH ranked AS (\
  SELECT r.*,\
         ROW_NUMBER() OVER (PARTITION BY r.user_id ORDER BY r.timestamp DESC) AS rn\
  FROM ratings r\
)\
SELECT m.title, u.name, r.rating, date(r.timestamp, 'unixepoch') AS rating_date\
FROM ranked r\
JOIN users u ON u.id = r.user_id\
JOIN movies m ON m.id = r.movie_id\
WHERE r.rn = 1\
ORDER BY r.timestamp DESC\
LIMIT 10;"
echo " "

echo "3. Фильмы с максимальным и минимальным средним рейтингом в одном списке. Колонка 'Рекомендуем' = 'Да' для максимального, 'Нет' для минимального."
echo --------------------------------------------------
sqlite3 movies_rating.db -box -echo "\
WITH avg_by_movie AS (\
  SELECT m.id, m.title, m.year, AVG(r.rating) AS avg_rating\
  FROM movies m\
  JOIN ratings r ON r.movie_id = m.id\
  GROUP BY m.id, m.title, m.year\
), bounds AS (\
  SELECT MAX(avg_rating) AS max_avg, MIN(avg_rating) AS min_avg FROM avg_by_movie\
)\
SELECT a.title, a.year, ROUND(a.avg_rating, 3) AS avg_rating, 'Да' AS "Рекомендуем"\
FROM avg_by_movie a, bounds b\
WHERE a.avg_rating = b.max_avg\
UNION ALL\
SELECT a.title, a.year, ROUND(a.avg_rating, 3) AS avg_rating, 'Нет' AS "Рекомендуем"\
FROM avg_by_movie a, bounds b\
WHERE a.avg_rating = b.min_avg\
ORDER BY year, title;"
echo " "

echo "4. Количество оценок и средняя оценка от женщин за период 2010-2012 гг."
echo --------------------------------------------------
sqlite3 movies_rating.db -box -echo "\
SELECT COUNT(*) AS ratings_count, ROUND(AVG(r.rating), 3) AS avg_rating\
FROM ratings r\
JOIN users u ON u.id = r.user_id\
WHERE u.gender = 'female'\
  AND date(r.timestamp, 'unixepoch') BETWEEN '2010-01-01' AND '2012-12-31';"
echo " "

echo "5. Список фильмов с их средней оценкой и местом в рейтинге по средней оценке. Отсортировать по году и названию. Показать первые 20."
echo --------------------------------------------------
sqlite3 movies_rating.db -box -echo "\
WITH avg_by_movie AS (\
  SELECT m.id, m.title, m.year, AVG(r.rating) AS avg_rating\
  FROM movies m\
  JOIN ratings r ON r.movie_id = m.id\
  GROUP BY m.id, m.title, m.year\
), ranked AS (\
  SELECT id, title, year, avg_rating,\
         DENSE_RANK() OVER (ORDER BY avg_rating DESC) AS rank_pos\
  FROM avg_by_movie\
)\
SELECT title, year, ROUND(avg_rating, 3) AS avg_rating, rank_pos\
FROM ranked\
ORDER BY year, title\
LIMIT 20;"
echo " "

echo "6. 10 последних зарегистрированных пользователей в формате 'Фамилия Имя|Дата регистрации'"
echo --------------------------------------------------
sqlite3 movies_rating.db -box -echo "\
SELECT (substr(u.name, instr(u.name, ' ') + 1) || ' ' || substr(u.name, 1, instr(u.name, ' ') - 1) || '|' || u.register_date) AS user_line\
FROM users u\
WHERE instr(u.name, ' ') > 0\
ORDER BY u.register_date DESC\
LIMIT 10;"
echo " "

echo "7. Рекурсивный CTE: таблица умножения 1..10"
echo --------------------------------------------------
sqlite3 movies_rating.db -box -echo "\
WITH RECURSIVE a(n) AS (\
  SELECT 1\
  UNION ALL\
  SELECT n+1 FROM a WHERE n < 10\
), b(n) AS (\
  SELECT 1\
  UNION ALL\
  SELECT n+1 FROM b WHERE n < 10\
)\
SELECT printf('%dx%d=%d', a.n, b.n, a.n*b.n) AS line\
FROM a CROSS JOIN b\
ORDER BY a.n, b.n;"
echo " "

echo "8. Рекурсивный CTE: выделить все жанры из movies (каждый жанр отдельной строкой)"
echo --------------------------------------------------
sqlite3 movies_rating.db -box -echo "\
WITH RECURSIVE\
  split(movie_id, rest, genre) AS (\
    SELECT m.id, m.genres || '|', ''\
    FROM movies m\
    UNION ALL\
    SELECT movie_id,\
           substr(rest, instr(rest, '|') + 1),\
           substr(rest, 1, instr(rest, '|') - 1)\
    FROM split\
    WHERE rest <> ''\
  )\
SELECT DISTINCT genre\
FROM split\
WHERE genre <> ''\
ORDER BY genre;"
echo " "

# После добавления в индекс сделайте файл исполняемым для Linux:
# git update-index --chmod=+x task4.bat
--------------------------------------------------
Run: ./task4.bat
1. Найти все пары пользователей, оценивших один и тот же фильм. Устранить дубликаты, исключить пары с самим собой. В списке оставить первые 100 записей.
--------------------------------------------------
SELECT u1.name AS user1, u2.name AS user2, m.title AS movieFROM ratings r1JOIN ratings r2 ON r1.movie_id = r2.movie_id AND r1.user_id < r2.user_idJOIN users u1 ON u1.id = r1.user_idJOIN users u2 ON u2.id = r2.user_idJOIN movies m ON m.id = r1.movie_idORDER BY m.title, user1, user2LIMIT 100;
 
2. 10 самых свежих оценок от разных пользователей: фильм, пользователь, оценка, дата (ГГГГ-ММ-ДД).
--------------------------------------------------
WITH ranked AS (  SELECT r.*,         ROW_NUMBER() OVER (PARTITION BY r.user_id ORDER BY r.timestamp DESC) AS rn  FROM ratings r)SELECT m.title, u.name, r.rating, date(r.timestamp, 'unixepoch') AS rating_dateFROM ranked rJOIN users u ON u.id = r.user_idJOIN movies m ON m.id = r.movie_idWHERE r.rn = 1ORDER BY r.timestamp DESCLIMIT 10;
 
3. Фильмы с максимальным и минимальным средним рейтингом в одном списке. Колонка 'Рекомендуем' = 'Да' для максимального, 'Нет' для минимального.
--------------------------------------------------
WITH avg_by_movie AS (  SELECT m.id, m.title, m.year, AVG(r.rating) AS avg_rating  FROM movies m  JOIN ratings r ON r.movie_id = m.id  GROUP BY m.id, m.title, m.year), bounds AS (  SELECT MAX(avg_rating) AS max_avg, MIN(avg_rating) AS min_avg FROM avg_by_movie)SELECT a.title, a.year, ROUND(a.avg_rating, 3) AS avg_rating, 'Да' AS РекомендуемFROM avg_by_movie a, bounds bWHERE a.avg_rating = b.max_avgUNION ALLSELECT a.title, a.year, ROUND(a.avg_rating, 3) AS avg_rating, 'Нет' AS РекомендуемFROM avg_by_movie a, bounds bWHERE a.avg_rating = b.min_avgORDER BY year, title;
 
4. Количество оценок и средняя оценка от женщин за период 2010-2012 гг.
--------------------------------------------------
SELECT COUNT(*) AS ratings_count, ROUND(AVG(r.rating), 3) AS avg_ratingFROM ratings rJOIN users u ON u.id = r.user_idWHERE u.gender = 'female'  AND date(r.timestamp, 'unixepoch') BETWEEN '2010-01-01' AND '2012-12-31';
 
5. Список фильмов с их средней оценкой и местом в рейтинге по средней оценке. Отсортировать по году и названию. Показать первые 20.
--------------------------------------------------
WITH avg_by_movie AS (  SELECT m.id, m.title, m.year, AVG(r.rating) AS avg_rating  FROM movies m  JOIN ratings r ON r.movie_id = m.id  GROUP BY m.id, m.title, m.year), ranked AS (  SELECT id, title, year, avg_rating,         DENSE_RANK() OVER (ORDER BY avg_rating DESC) AS rank_pos  FROM avg_by_movie)SELECT title, year, ROUND(avg_rating, 3) AS avg_rating, rank_posFROM rankedORDER BY year, titleLIMIT 20;
 
6. 10 последних зарегистрированных пользователей в формате 'Фамилия Имя|Дата регистрации'
--------------------------------------------------
SELECT (substr(u.name, instr(u.name, ' ') + 1) || ' ' || substr(u.name, 1, instr(u.name, ' ') - 1) || '|' || u.register_date) AS user_lineFROM users uWHERE instr(u.name, ' ') > 0ORDER BY u.register_date DESCLIMIT 10;
 
7. Рекурсивный CTE: таблица умножения 1..10
--------------------------------------------------
WITH RECURSIVE a(n) AS (  SELECT 1  UNION ALL  SELECT n+1 FROM a WHERE n < 10), b(n) AS (  SELECT 1  UNION ALL  SELECT n+1 FROM b WHERE n < 10)SELECT printf('%dx%d=%d', a.n, b.n, a.n*b.n) AS lineFROM a CROSS JOIN bORDER BY a.n, b.n;
 
8. Рекурсивный CTE: выделить все жанры из movies (каждый жанр отдельной строкой)
--------------------------------------------------
WITH RECURSIVE  split(movie_id, rest, genre) AS (    SELECT m.id, m.genres || '|', ''    FROM movies m    UNION ALL    SELECT movie_id,           substr(rest, instr(rest, '|') + 1),           substr(rest, 1, instr(rest, '|') - 1)    FROM split    WHERE rest <> ''  )SELECT DISTINCT genreFROM splitWHERE genre <> ''ORDER BY genre;
--------------------------------------------------
Total ok: 3
Total error: 0
--------------------------------------------------
/home/andrey/labs/DB/304_DB_Afonkin_DE
Task04: add db_init.sql and task4.bat with required queries
Task from branch: Task04
Creation date: 10/31/2025 07:07:33
To github.com-mrsu:andpop-mrsu/304_DB_Afonkin_DE.git
To github.com-mrsu:andpop-mrsu/304_DB_Afonkin_DE.git
   f941fca..80a7f4f  master -> master
   f941fca..80a7f4f  master -> master
304_DB_Aksenov_RM
304_DB_Artemev_DA
=====================================================
/home/andrey/labs/DB/304_DB_Artemev_DA
Из github.com-mrsu:andpop-mrsu/304_DB_Artemev_DA
Из github.com-mrsu:andpop-mrsu/304_DB_Artemev_DA
 * branch            master     -> FETCH_HEAD
 * branch            master     -> FETCH_HEAD
Уже актуально.
fatal: внешний репозиторий student уже существует
fatal: внешний репозиторий student уже существует
Из https://github.com/Dart1117/304_DB_Artemev_DA
Из https://github.com/Dart1117/304_DB_Artemev_DA
 * [новая ветка]     Task04     -> student/Task04
 * [новая ветка]     Task04     -> student/Task04
Обновление 4eacc41..990f8b5
Fast-forward (no commit created; -m option ignored)
 Task04/db_init.sql | 33181 +++++++++++++++++++++++++++++++++++++++++++++++++++
 Task04/task4.bat   |   133 +
 2 files changed, 33314 insertions(+)
 create mode 100644 Task04/db_init.sql
 create mode 100644 Task04/task4.bat
--------------------------------------------------
Task:  /home/andrey/labs/DB/304_DB_Artemev_DA/Task04
--------------------------------------------------
Check path: db_init.sql
--------------------------------------------------
Check path: task4.bat
#!/bin/bash

chcp 65001

sqlite3 movies_rating.db < db_init.sql

echo "1. Найти все пары пользователей, оценивших один и тот же фильм. Устранить дубликаты, проверить отсутствие пар с самим собой. Для каждой пары должны быть указаны имена пользователей и название фильма, который они ценили. В списке оставить первые 100 записей."
echo --------------------------------------------------
sqlite3 movies_rating.db -box -echo "
SELECT u1.name AS user1_name, u2.name AS user2_name, m.title AS movie_title
FROM ratings r1
JOIN ratings r2 ON r1.movie_id = r2.movie_id AND r1.user_id < r2.user_id
JOIN users u1 ON r1.user_id = u1.id
JOIN users u2 ON r2.user_id = u2.id
JOIN movies m ON r1.movie_id = m.id
LIMIT 100;
"
echo " "

echo "2. Найти 10 самых старых оценок от разных пользователей, вывести названия фильмов, имена пользователей, оценку, дату отзыва в формате ГГГГ-ММ-ДД."
echo --------------------------------------------------
sqlite3 movies_rating.db -box -echo "
SELECT m.title AS movie_title, u.name AS user_name, r.rating, date(r.timestamp, 'unixepoch') AS review_date
FROM ratings r
JOIN movies m ON r.movie_id = m.id
JOIN users u ON r.user_id = u.id
ORDER BY r.timestamp ASC
LIMIT 10;
"
echo " "

echo "3. Вывести в одном списке все фильмы с максимальным средним рейтингом и все фильмы с минимальным средним рейтингом. Общий список отсортировать по году выпуска и названию фильма. В зависимости от рейтинга в колонке \"Рекомендуем\" для фильмов должно быть написано \"Да\" или \"Нет\"."
echo --------------------------------------------------
sqlite3 movies_rating.db -box -echo "
WITH avg_ratings AS (
  SELECT m.id, m.title, m.year, ROUND(AVG(r.rating), 2) AS avg_rating
  FROM movies m
  JOIN ratings r ON m.id = r.movie_id
  GROUP BY m.id, m.title, m.year
),
extremes AS (
  SELECT MAX(avg_rating) AS max_rating, MIN(avg_rating) AS min_rating FROM avg_ratings
)
SELECT ar.title, ar.year, ar.avg_rating,
  CASE 
    WHEN ar.avg_rating = ext.max_rating THEN 'Да'
    WHEN ar.avg_rating = ext.min_rating THEN 'Нет'
    ELSE ''
  END AS 'Рекомендуем'
FROM avg_ratings ar, extremes ext
WHERE ar.avg_rating = ext.max_rating OR ar.avg_rating = ext.min_rating
ORDER BY ar.year, ar.title;
"
echo " "

echo "4. Вычислить количество оценок и среднюю оценку, которую дали фильмам пользователи-мужчины в период с 2011 по 2014 год."
echo --------------------------------------------------
sqlite3 movies_rating.db -box -echo "
SELECT COUNT(*) as num_ratings, ROUND(AVG(r.rating),2) as avg_rating
FROM ratings r
JOIN users u ON r.user_id = u.id
WHERE u.gender = 'male' AND date(r.timestamp, 'unixepoch') BETWEEN '2011-01-01' AND '2014-12-31';
"
echo " "

echo "5. Составить список фильмов с указанием средней оценки и количества пользователей, которые их оценили. Полученный список отсортировать по году выпуска и названиям фильмов. В списке оставить первые 20 записей."
echo --------------------------------------------------
sqlite3 movies_rating.db -box -echo "
SELECT m.title, m.year, ROUND(AVG(r.rating),2) AS avg_rating, COUNT(DISTINCT r.user_id) AS num_users
FROM movies m
LEFT JOIN ratings r ON m.id = r.movie_id
GROUP BY m.id, m.title, m.year
ORDER BY m.year, m.title
LIMIT 20;
"
echo " "

echo "6. Определить самый распространенный жанр фильма и количество фильмов в этом жанре. Отдельную таблицу для жанров не использовать, жанры нужно извлекать из таблицы movies."
echo --------------------------------------------------
sqlite3 movies_rating.db -box -echo "
WITH genre_list AS (
  SELECT id, TRIM(genre) AS genre
  FROM movies, 
    (SELECT id, value AS genre
     FROM movies, 
       (SELECT id, genres FROM movies) AS mg,
       json_each(replace(replace(mg.genres, '|', '","'), ',', '","'))
    )
)
SELECT genre, COUNT(*) as num_movies
FROM (
  SELECT m.id, TRIM(g) AS genre
  FROM movies m, 
  (SELECT value AS g FROM json_each('[' || REPLACE(m.genres, '|', '","') || ']')) 
)
GROUP BY genre
ORDER BY num_movies DESC
LIMIT 1;
"
echo " "

echo "7. Вывести список из 10 последних зарегистрированных пользователей в формате \"Фамилия Имя|Дата регистрации\" (сначала фамилия, потом имя)."
echo --------------------------------------------------
sqlite3 movies_rating.db -box -echo "
SELECT name || '|' || register_date AS user_info
FROM users
ORDER BY register_date DESC
LIMIT 10;
"
echo " "

echo "8. С помощью рекурсивного CTE определить, на какие дни недели приходился ваш день рождения в каждом году."
echo --------------------------------------------------
sqlite3 movies_rating.db -box -echo "
WITH RECURSIVE years(y) AS (
  SELECT 1990
  UNION ALL
  SELECT y+1 FROM years WHERE y+1 <= 2025
)
SELECT y AS year, 
  strftime('%w', printf('%d-%02d-%02d', y, 4, 16)) AS weekday_num,
  CASE strftime('%w', printf('%d-%02d-%02d', y, 4, 16))
    WHEN '0' THEN 'Воскресенье'
    WHEN '1' THEN 'Понедельник'
    WHEN '2' THEN 'Вторник'
    WHEN '3' THEN 'Среда'
    WHEN '4' THEN 'Четверг'
    WHEN '5' THEN 'Пятница'
    WHEN '6' THEN 'Суббота'
  END AS weekday_name
FROM years;
"
echo " "
--------------------------------------------------
Run: ./task4.bat
PS>TerminatingError(): "Cannot run a document in the middle of a pipeline: /home/andrey/labs/DB/304_DB_Artemev_DA/Task04/task4.bat."

InvalidOperation: /home/andrey/projects/mrsu/02_DB/tools/check_tasks/checks_for_task.ps1:32
Line |
  32 |      $str = (& $command $params | Out-String)
     |              ~~~~~~~~~~~~~~~~~~
     | Cannot run a document in the middle of a pipeline: /home/andrey/labs/DB/304_DB_Artemev_DA/Task04/task4.bat.

InvalidOperation: /home/andrey/projects/mrsu/02_DB/tools/check_tasks/checks_for_task.ps1:32
Line |
  32 |      $str = (& $command $params | Out-String)
     |              ~~~~~~~~~~~~~~~~~~
     | Cannot run a document in the middle of a pipeline:
     | /home/andrey/labs/DB/304_DB_Artemev_DA/Task04/task4.bat.


Execution fails
--------------------------------------------------
Total ok: 2
Total error: 1
--------------------------------------------------
/home/andrey/labs/DB/304_DB_Artemev_DA
Task04
Task from branch: Task04
Creation date: 10/30/2025 15:06:51
To github.com-mrsu:andpop-mrsu/304_DB_Artemev_DA.git
To github.com-mrsu:andpop-mrsu/304_DB_Artemev_DA.git
   4eacc41..990f8b5  master -> master
   4eacc41..990f8b5  master -> master
304_DB_Dolya_OA
304_DB_Geraskin_RG
304_DB_Isakov_VV
304_DB_Kiselev_NS
304_DB_Kizhaev_RP
304_DB_Kochetov_VA
304_DB_Kurmakaev_RA
=====================================================
/home/andrey/labs/DB/304_DB_Kurmakaev_RA
Из github.com-mrsu:andpop-mrsu/304_DB_Kurmakaev_RA
Из github.com-mrsu:andpop-mrsu/304_DB_Kurmakaev_RA
 * branch            master     -> FETCH_HEAD
 * branch            master     -> FETCH_HEAD
Уже актуально.
fatal: внешний репозиторий student уже существует
fatal: внешний репозиторий student уже существует
Из https://github.com/th000mas/304_DB_Kurmakaev_RA
Из https://github.com/th000mas/304_DB_Kurmakaev_RA
 * [новая ветка]     Task04     -> student/Task04
 * [новая ветка]     Task04     -> student/Task04
Merge made by the 'recursive' strategy.
 Task04/db_init.sql | 33178 +++++++++++++++++++++++++++++++++++++++++++++++++++
 Task04/task04.bat  |   174 +
 2 files changed, 33352 insertions(+)
 create mode 100644 Task04/db_init.sql
 create mode 100755 Task04/task04.bat
--------------------------------------------------
Task:  /home/andrey/labs/DB/304_DB_Kurmakaev_RA/Task04
--------------------------------------------------
Check path: db_init.sql
--------------------------------------------------
Check path: task4.bat
task4.bat not found
--------------------------------------------------
Run: ./task4.bat

&: /home/andrey/projects/mrsu/02_DB/tools/check_tasks/checks_for_task.ps1:32
Line |
  32 |      $str = (& $command $params | Out-String)
     |                ~~~~~~~~
     | The term './task4.bat' is not recognized as a name of a cmdlet, function, script file, or executable program. Check the spelling of the name, or if a path was included, verify that the path is correct and try again.

&: /home/andrey/projects/mrsu/02_DB/tools/check_tasks/checks_for_task.ps1:32
Line |
  32 |      $str = (& $command $params | Out-String)
     |                ~~~~~~~~
     | The term './task4.bat' is not recognized as a name of a cmdlet, function,
     | script file, or executable program. Check the spelling of the name, or if a
     | path was included, verify that the path is correct and try again.


Execution fails
--------------------------------------------------
Total ok: 1
Total error: 2
--------------------------------------------------
/home/andrey/labs/DB/304_DB_Kurmakaev_RA
Task04
Task from branch: Task04
Creation date: 10/30/2025 12:05:36
To github.com-mrsu:andpop-mrsu/304_DB_Kurmakaev_RA.git
To github.com-mrsu:andpop-mrsu/304_DB_Kurmakaev_RA.git
   2e84d79..f276130  master -> master
   2e84d79..f276130  master -> master
304_DB_Kuvakin_RA
=====================================================
/home/andrey/labs/DB/304_DB_Kuvakin_RA
Из github.com-mrsu:andpop-mrsu/304_DB_Kuvakin_RA
Из github.com-mrsu:andpop-mrsu/304_DB_Kuvakin_RA
 * branch            master     -> FETCH_HEAD
 * branch            master     -> FETCH_HEAD
Уже актуально.
fatal: внешний репозиторий student уже существует
fatal: внешний репозиторий student уже существует
Из https://github.com/Romario-OpG/304_DB_Kuvakin_RA
Из https://github.com/Romario-OpG/304_DB_Kuvakin_RA
 * [новая ветка]     Task04     -> student/Task04
 * [новая ветка]     Task04     -> student/Task04
   2b5f252..9ffc47d  master     -> student/master
   2b5f252..9ffc47d  master     -> student/master
Обновление 9ffc47d..7d1dddf
Fast-forward (no commit created; -m option ignored)
 Task04/db_init.sql | 33180 +++++++++++++++++++++++++++++++++++++++++++++++++++
 Task04/task4.bat   |    43 +
 2 files changed, 33223 insertions(+)
 create mode 100644 Task04/db_init.sql
 create mode 100644 Task04/task4.bat
--------------------------------------------------
Task:  /home/andrey/labs/DB/304_DB_Kuvakin_RA/Task04
--------------------------------------------------
Check path: db_init.sql
--------------------------------------------------
Check path: task4.bat
#!/bin/bash
chcp 65001
sqlite3 movies_rating.db < db_init.sql

echo "1. Найти все пары пользователей, оценивших один и тот же фильм. Устранить дубликаты, проверить отсутствие пар с самим собой. Для каждой пары должны быть указаны имена пользователей и название фильма, который они ценили. В списке оставить первые 100 записей."
echo --------------------------------------------------
sqlite3 movies_rating.db -box -echo "SELECT DISTINCT u1.name AS 'Пользователь 1', u2.name AS 'Пользователь 2', m.title AS 'Название Фильма' FROM ratings r1 JOIN ratings r2 ON r1.movie_id = r2.movie_id AND r1.user_id < r2.user_id JOIN users u1 ON r1.user_id = u1.id JOIN users u2 ON r2.user_id = u2.id JOIN movies m ON r1.movie_id = m.id LIMIT 100"
echo " "

echo "2. Найти 10 самых свежих оценок от разных пользователей, вывести названия фильмов, имена пользователей, оценку, дату отзыва в формате ГГГГ-ММ-ДД."
echo --------------------------------------------------
sqlite3 movies_rating.db -box -echo "SELECT m.title AS 'Название фильма', u.name AS 'Имя', r.rating AS 'Оценка', date(r.timestamp, 'unixepoch') AS 'Дата Отзыва' FROM ratings r JOIN users u ON r.user_id = u.id JOIN movies m ON r.movie_id = m.id WHERE r.timestamp IN (SELECT MAX(r2.timestamp) FROM ratings r2 GROUP BY r2.user_id) ORDER BY r.timestamp DESC LIMIT 10"
echo " "

echo "3. Вывести в одном списке все фильмы с максимальным средним рейтингом и все фильмы с минимальным средним рейтингом. Общий список отсортировать по году выпуска и названию фильма. В зависимости от рейтинга в колонке 'Рекомендуем' для фильмов должно быть написано 'Да' или 'Нет'."
echo --------------------------------------------------
sqlite3 movies_rating.db -box -echo "WITH avg_ratings AS (SELECT movie_id, AVG(rating) as avg_rating FROM ratings GROUP BY movie_id), max_min AS (SELECT MAX(avg_rating) as max_r, MIN(avg_rating) as min_r FROM avg_ratings) SELECT m.title AS 'Название', m.year AS 'Год', ar.avg_rating AS 'Средний рейтинг', CASE WHEN ar.avg_rating = (SELECT max_r FROM max_min) THEN 'Да' ELSE 'Нет' END AS Рекомендуем FROM movies m JOIN avg_ratings ar ON m.id = ar.movie_id WHERE ar.avg_rating = (SELECT max_r FROM max_min) OR ar.avg_rating = (SELECT min_r FROM max_min) ORDER BY m.year, m.title"
echo " "

echo "4. Вычислить количество оценок и среднюю оценку, которую дали фильмам пользователи-женщины в период с 2010 по 2012 год."
echo --------------------------------------------------
sqlite3 movies_rating.db -box -echo "SELECT COUNT(*) AS 'Количество оценок', AVG(r.rating) AS 'Средняя оценка' FROM ratings r JOIN users u ON r.user_id = u.id WHERE u.gender = 'female' AND strftime('%Y', datetime(r.timestamp, 'unixepoch')) BETWEEN '2010' AND '2012'"
echo " "

echo "5. Составить список фильмов с указанием их средней оценки и места в рейтинге по средней оценке. Отсортировать по году выпуска и названиям фильмов. Показать первые 20 записей."
echo --------------------------------------------------
sqlite3 movies_rating.db -box -echo "SELECT title AS 'Название фильма', year AS 'Год выпуска', AVG(r.rating) AS 'Средняя оценка', RANK() OVER (ORDER BY AVG(r.rating) DESC) AS 'Место в рейтинге' FROM movies m JOIN ratings r ON m.id = r.movie_id GROUP BY m.id ORDER BY year ASC, title ASC LIMIT 20"
echo " "

echo "6. Вывести список из 10 последних зарегистрированных пользователей в формате 'Фамилия Имя|Дата регистрации'."
echo --------------------------------------------------
sqlite3 movies_rating.db -noheader -batch -echo "SELECT name || '|' || register_date AS 'Фамилия Имя|Дата регистрации' FROM users ORDER BY register_date DESC LIMIT 10"
echo " "

echo "7. Вывести таблицу умножения чисел от 1 до 10 с помощью рекурсивного CTE как в примере 1x1=1 1x2=2..."
echo --------------------------------------------------
sqlite3 movies_rating.db -noheader -batch -echo "WITH RECURSIVE x(i, j) AS (SELECT 1, 1 UNION ALL SELECT i, j+1 FROM x WHERE j<10 UNION ALL SELECT i+1, 1 FROM x WHERE j=10 AND i<10) SELECT i || 'x' || j || '=' || (i*j) FROM x ORDER BY i, j"
echo " "

echo "8. С помощью рекурсивного CTE выделить все жанры фильмов, имеющиеся в таблице movies (каждый жанр в отдельной строке)"
echo --------------------------------------------------
sqlite3 movies_rating.db -noheader -batch -echo "WITH RECURSIVE split(id, genre, rest) AS (SELECT id, '', genres || '|' FROM movies UNION ALL SELECT id, substr(rest, 0, instr(rest, '|')), substr(rest, instr(rest, '|')+1) FROM split WHERE rest!='') SELECT DISTINCT genre FROM split WHERE genre!='' ORDER BY genre"
echo " "
--------------------------------------------------
Run: ./task4.bat
PS>TerminatingError(): "Cannot run a document in the middle of a pipeline: /home/andrey/labs/DB/304_DB_Kuvakin_RA/Task04/task4.bat."

InvalidOperation: /home/andrey/projects/mrsu/02_DB/tools/check_tasks/checks_for_task.ps1:32
Line |
  32 |      $str = (& $command $params | Out-String)
     |              ~~~~~~~~~~~~~~~~~~
     | Cannot run a document in the middle of a pipeline: /home/andrey/labs/DB/304_DB_Kuvakin_RA/Task04/task4.bat.

InvalidOperation: /home/andrey/projects/mrsu/02_DB/tools/check_tasks/checks_for_task.ps1:32
Line |
  32 |      $str = (& $command $params | Out-String)
     |              ~~~~~~~~~~~~~~~~~~
     | Cannot run a document in the middle of a pipeline:
     | /home/andrey/labs/DB/304_DB_Kuvakin_RA/Task04/task4.bat.


Execution fails
--------------------------------------------------
Total ok: 2
Total error: 1
--------------------------------------------------
/home/andrey/labs/DB/304_DB_Kuvakin_RA
Task04
Task from branch: Task04
Creation date: 10/31/2025 07:00:32
To github.com-mrsu:andpop-mrsu/304_DB_Kuvakin_RA.git
To github.com-mrsu:andpop-mrsu/304_DB_Kuvakin_RA.git
   9ffc47d..7d1dddf  master -> master
   9ffc47d..7d1dddf  master -> master
304_DB_Lukovataya_KV
304_DB_Migachev_IP
=====================================================
/home/andrey/labs/DB/304_DB_Migachev_IP
Из github.com-mrsu:andpop-mrsu/304_DB_Migachev_IP
Из github.com-mrsu:andpop-mrsu/304_DB_Migachev_IP
 * branch            master     -> FETCH_HEAD
 * branch            master     -> FETCH_HEAD
Уже актуально.
fatal: внешний репозиторий student уже существует
fatal: внешний репозиторий student уже существует
Из https://github.com/Just-Kain/304_DB_Migachev_IP
Из https://github.com/Just-Kain/304_DB_Migachev_IP
 * [новая ветка]     Task04     -> student/Task04
 * [новая ветка]     Task04     -> student/Task04
   9db6686..ba4169d  master     -> student/master
   9db6686..ba4169d  master     -> student/master
Обновление ba4169d..c0c9080
Fast-forward (no commit created; -m option ignored)
 Task04/db_init.sql | 33178 +++++++++++++++++++++++++++++++++++++++++++++++++++
 Task04/task4.bat   |    44 +
 2 files changed, 33222 insertions(+)
 create mode 100644 Task04/db_init.sql
 create mode 100755 Task04/task4.bat
--------------------------------------------------
Task:  /home/andrey/labs/DB/304_DB_Migachev_IP/Task04
--------------------------------------------------
Check path: db_init.sql
--------------------------------------------------
Check path: task4.bat
#!/bin/bash
chcp 65001

sqlite3 movies_rating.db < db_init.sql

echo 1. Найти все пары пользователей, оценивших один и тот же фильм. Устранить дубликаты, проверить отсутствие пар с самим собой. Для каждой пары должны быть указаны имена пользователей и название фильма, который они оценили. В списке оставить первые 100 записей.
echo --------------------------------------------------
sqlite3 movies_rating.db -box "SELECT DISTINCT u1.name as user1, u2.name as user2, m.title as movie FROM ratings r1 JOIN ratings r2 ON r1.movie_id = r2.movie_id AND r1.user_id < r2.user_id JOIN users u1 ON r1.user_id = u1.id JOIN users u2 ON r2.user_id = u2.id JOIN movies m ON r1.movie_id = m.id LIMIT 100;"
echo " "

echo 2. Найти 10 самых старых оценок от разных пользователей, вывести названия фильмов, имена пользователей, оценку, дату отзыва в формате ГГГГ-ММ-ДД.
echo --------------------------------------------------
sqlite3 movies_rating.db -box "SELECT m.title as 'Название фильма', u.name as 'Имя пользователя', r.rating as 'Оценка', date(r.timestamp, 'unixepoch') as 'Дата отзыва' FROM ratings r JOIN movies m ON r.movie_id = m.id JOIN users u ON r.user_id = u.id ORDER BY r.timestamp ASC LIMIT 10;"
echo " "

echo 3. Вывести в одном списке все фильмы с максимальным средним рейтингом и все фильмы с минимальным средним рейтингом. Общий список отсортировать по году выпуска и названию фильма. В зависимости от рейтинга в колонке "Рекомендуем" для фильмов должно быть написано "Да" или "Нет".
echo --------------------------------------------------
sqlite3 movies_rating.db -box "WITH movie_ratings AS (SELECT m.id, m.title, m.year, AVG(r.rating) as avg_rating FROM movies m JOIN ratings r ON m.id = r.movie_id GROUP BY m.id, m.title, m.year), max_min_ratings AS (SELECT MAX(avg_rating) as max_rating, MIN(avg_rating) as min_rating FROM movie_ratings) SELECT mr.title as 'Название фильма', mr.year as 'Год', ROUND(mr.avg_rating, 2) as 'Средний рейтинг', CASE WHEN mr.avg_rating = (SELECT max_rating FROM max_min_ratings) THEN 'Да' WHEN mr.avg_rating = (SELECT min_rating FROM max_min_ratings) THEN 'Нет' END as 'Рекомендуем' FROM movie_ratings mr WHERE mr.avg_rating = (SELECT max_rating FROM max_min_ratings) OR mr.avg_rating = (SELECT min_rating FROM max_min_ratings) ORDER BY mr.year, mr.title;"
echo " "

echo 4. Вычислить количество оценок и среднюю оценку, которую дали фильмам пользователи-мужчины в период с 2011 по 2014 год.
echo --------------------------------------------------
sqlite3 movies_rating.db -box "SELECT COUNT(*) as 'Количество оценок', ROUND(AVG(r.rating), 2) as 'Средняя оценка' FROM ratings r JOIN users u ON r.user_id = u.id WHERE u.gender = 'M' AND strftime('%%Y', datetime(r.timestamp, 'unixepoch')) BETWEEN '2011' AND '2014';"
echo " "

echo 5. Составить список фильмов с указанием средней оценки и количества пользователей, которые их оценили. Полученный список отсортировать по году выпуска и названиям фильмов. В списке оставить первые 20 записей.
echo --------------------------------------------------
sqlite3 movies_rating.db -box "SELECT m.title as 'Название фильма', m.year as 'Год', ROUND(AVG(r.rating), 2) as 'Средняя оценка', COUNT(DISTINCT r.user_id) as 'Количество оценок' FROM movies m JOIN ratings r ON m.id = r.movie_id GROUP BY m.id, m.title, m.year ORDER BY m.year, m.title LIMIT 20;"
echo " "

echo 6. Определить самый распространенный жанр фильма и количество фильмов в этом жанре. Отдельную таблицу для жанров не использовать, жанры нужно извлекать из таблицы movies.
echo --------------------------------------------------
sqlite3 movies_rating.db -box "WITH split(genre, rest) AS (SELECT CASE WHEN instr(genres, '|') > 0 THEN substr(genres, 1, instr(genres, '|') - 1) ELSE genres END, CASE WHEN instr(genres, '|') > 0 THEN substr(genres, instr(genres, '|') + 1) ELSE '' END FROM movies WHERE genres != '' AND genres IS NOT NULL UNION ALL SELECT CASE WHEN instr(rest, '|') > 0 THEN substr(rest, 1, instr(rest, '|') - 1) ELSE rest END, CASE WHEN instr(rest, '|') > 0 THEN substr(rest, instr(rest, '|') + 1) ELSE '' END FROM split WHERE rest != '') SELECT trim(genre) as 'Самый распространенный жанр', COUNT(*) as 'Количество фильмов' FROM split WHERE genre != '' AND genre IS NOT NULL GROUP BY trim(genre) ORDER BY COUNT(*) DESC LIMIT 1;"
echo " "

echo 7. Вывести список из 10 последних зарегистрированных пользователей в формате "Фамилия Имя|Дата регистрации" (сначала фамилия, потом имя).
echo --------------------------------------------------
sqlite3 movies_rating.db -box "SELECT substr(name, instr(name, ' ') + 1) || ' ' || substr(name, 1, instr(name, ' ') - 1) || '|' || register_date as 'Пользователь|Дата регистрации' FROM users ORDER BY register_date DESC LIMIT 10;"
echo " "

echo 8. С помощью рекурсивного CTE определить, на какие дни недели приходился ваш день рождения в каждом году.
echo --------------------------------------------------
sqlite3 movies_rating.db -box "WITH RECURSIVE birthday_years(year) AS (SELECT 2005 UNION ALL SELECT year + 1 FROM birthday_years WHERE year < 2025) SELECT year as 'Год', CASE strftime('%%w', year || '-05-17') WHEN '0' THEN 'Воскресенье' WHEN '1' THEN 'Понедельник' WHEN '2' THEN 'Вторник' WHEN '3' THEN 'Среда' WHEN '4' THEN 'Четверг' WHEN '5' THEN 'Пятница' WHEN '6' THEN 'Суббота' END as 'День недели' FROM birthday_years ORDER BY year;"
echo " "
--------------------------------------------------
Run: ./task4.bat
1. Найти все пары пользователей, оценивших один и тот же фильм. Устранить дубликаты, проверить отсутствие пар с самим собой. Для каждой пары должны быть указаны имена пользователей и название фильма, который они оценили. В списке оставить первые 100 записей.
--------------------------------------------------
┌───────────────┬─────────────────────┬──────────────────────┐
│     user1     │        user2        │        movie         │
├───────────────┼─────────────────────┼──────────────────────┤
│ Devonte Stamm │ Immanuel Bode       │ Toy Story            │
│ Devonte Stamm │ Holden Lueilwitz    │ Toy Story            │
│ Devonte Stamm │ Geovany Ratke       │ Toy Story            │
│ Devonte Stamm │ Dina Lindgren       │ Toy Story            │
│ Devonte Stamm │ Taya Rath           │ Toy Story            │
│ Devonte Stamm │ Eda Steuber         │ Toy Story            │
│ Devonte Stamm │ Charlene Medhurst   │ Toy Story            │
│ Devonte Stamm │ Estell Dicki        │ Toy Story            │
│ Devonte Stamm │ Cora DuBuque        │ Toy Story            │
│ Devonte Stamm │ Iliana Lowe         │ Toy Story            │
│ Devonte Stamm │ Mario Dibbert       │ Toy Story            │
│ Devonte Stamm │ Aiyana Jenkins      │ Toy Story            │
│ Devonte Stamm │ Ottilie Hudson      │ Toy Story            │
│ Devonte Stamm │ Deonte Hane         │ Toy Story            │
│ Devonte Stamm │ Leila Kassulke      │ Toy Story            │
│ Devonte Stamm │ Moriah Mohr         │ Toy Story            │
│ Devonte Stamm │ Cassandra Powlowski │ Toy Story            │
│ Devonte Stamm │ Watson Mohr         │ Toy Story            │
│ Devonte Stamm │ Marcus Rau          │ Toy Story            │
│ Devonte Stamm │ Ocie Nikolaus       │ Toy Story            │
│ Devonte Stamm │ Zachariah Nolan     │ Toy Story            │
│ Devonte Stamm │ Enid Stanton        │ Toy Story            │
│ Devonte Stamm │ Alaina Beatty       │ Toy Story            │
│ Devonte Stamm │ Ed Gislason         │ Toy Story            │
│ Devonte Stamm │ Albertha Littel     │ Toy Story            │
│ Devonte Stamm │ Neoma Lowe          │ Toy Story            │
│ Devonte Stamm │ Davin Lubowitz      │ Toy Story            │
│ Devonte Stamm │ Paolo Dooley        │ Toy Story            │
│ Devonte Stamm │ Ona Nader           │ Toy Story            │
│ Devonte Stamm │ Zechariah Kuphal    │ Toy Story            │
│ Devonte Stamm │ Constance Reynolds  │ Toy Story            │
│ Devonte Stamm │ Justus Fadel        │ Toy Story            │
│ Devonte Stamm │ Fritz Graham        │ Toy Story            │
│ Devonte Stamm │ Francis Deckow      │ Toy Story            │
│ Devonte Stamm │ Octavia Mayert      │ Toy Story            │
│ Devonte Stamm │ Brigitte Johnston   │ Toy Story            │
│ Devonte Stamm │ Wanda Kub           │ Toy Story            │
│ Devonte Stamm │ Earlene Marks       │ Toy Story            │
│ Devonte Stamm │ Heaven Volkman      │ Toy Story            │
│ Devonte Stamm │ Dwight Reichel      │ Grumpier Old Men     │
│ Devonte Stamm │ Eda Steuber         │ Grumpier Old Men     │
│ Devonte Stamm │ Iliana Lowe         │ Grumpier Old Men     │
│ Devonte Stamm │ America Mante       │ Grumpier Old Men     │
│ Devonte Stamm │ Ottilie Hudson      │ Grumpier Old Men     │
│ Devonte Stamm │ Deonte Hane         │ Grumpier Old Men     │
│ Devonte Stamm │ Gabe Bashirian      │ Grumpier Old Men     │
│ Devonte Stamm │ Lizzie Murphy       │ Grumpier Old Men     │
│ Devonte Stamm │ Zachariah Nolan     │ Grumpier Old Men     │
│ Devonte Stamm │ Alaina Beatty       │ Grumpier Old Men     │
│ Devonte Stamm │ Justus Fadel        │ Grumpier Old Men     │
│ Devonte Stamm │ Hyman Gleichner     │ Grumpier Old Men     │
│ Devonte Stamm │ Elwin Turcotte      │ Grumpier Old Men     │
│ Devonte Stamm │ Celestino Bergnaum  │ Grumpier Old Men     │
│ Devonte Stamm │ Patience Metz       │ Grumpier Old Men     │
│ Devonte Stamm │ Dwight Reichel      │ Heat                 │
│ Devonte Stamm │ Martina Kertzmann   │ Heat                 │
│ Devonte Stamm │ Taya Rath           │ Heat                 │
│ Devonte Stamm │ Dayana Wiegand      │ Heat                 │
│ Devonte Stamm │ Gail Hintz          │ Heat                 │
│ Devonte Stamm │ Savion Upton        │ Heat                 │
│ Devonte Stamm │ Iliana Lowe         │ Heat                 │
│ Devonte Stamm │ Deonte Hane         │ Heat                 │
│ Devonte Stamm │ Leila Kassulke      │ Heat                 │
│ Devonte Stamm │ Marcus Rau          │ Heat                 │
│ Devonte Stamm │ Edmund Mueller      │ Heat                 │
│ Devonte Stamm │ Zachariah Nolan     │ Heat                 │
│ Devonte Stamm │ Alaina Beatty       │ Heat                 │
│ Devonte Stamm │ Myrtie Gutkowski    │ Heat                 │
│ Devonte Stamm │ Paolo Dooley        │ Heat                 │
│ Devonte Stamm │ Jamarcus Bailey     │ Heat                 │
│ Devonte Stamm │ Justus Fadel        │ Heat                 │
│ Devonte Stamm │ Elwin Turcotte      │ Heat                 │
│ Devonte Stamm │ Adell Gusikowski    │ Heat                 │
│ Devonte Stamm │ Destinee Wolf       │ Heat                 │
│ Devonte Stamm │ Earlene Marks       │ Heat                 │
│ Devonte Stamm │ Patience Metz       │ Heat                 │
│ Devonte Stamm │ Jamel Nader         │ Seven (a.k.a. Se7en) │
│ Devonte Stamm │ Dwight Reichel      │ Seven (a.k.a. Se7en) │
│ Devonte Stamm │ Pablo Kuhlman       │ Seven (a.k.a. Se7en) │
│ Devonte Stamm │ Chester Price       │ Seven (a.k.a. Se7en) │
│ Devonte Stamm │ Westley Wisoky      │ Seven (a.k.a. Se7en) │
│ Devonte Stamm │ Geovany Ratke       │ Seven (a.k.a. Se7en) │
│ Devonte Stamm │ Zella Schamberger   │ Seven (a.k.a. Se7en) │
│ Devonte Stamm │ Dina Lindgren       │ Seven (a.k.a. Se7en) │
│ Devonte Stamm │ Taya Rath           │ Seven (a.k.a. Se7en) │
│ Devonte Stamm │ Eda Steuber         │ Seven (a.k.a. Se7en) │
│ Devonte Stamm │ Lyda Friesen        │ Seven (a.k.a. Se7en) │
│ Devonte Stamm │ Savion Upton        │ Seven (a.k.a. Se7en) │
│ Devonte Stamm │ Madelynn Abshire    │ Seven (a.k.a. Se7en) │
│ Devonte Stamm │ Stone Greenholt     │ Seven (a.k.a. Se7en) │
│ Devonte Stamm │ America Mante       │ Seven (a.k.a. Se7en) │
│ Devonte Stamm │ Ottilie Hudson      │ Seven (a.k.a. Se7en) │
│ Devonte Stamm │ Louisa Orn          │ Seven (a.k.a. Se7en) │
│ Devonte Stamm │ Watson Mohr         │ Seven (a.k.a. Se7en) │
│ Devonte Stamm │ Valentina Turner    │ Seven (a.k.a. Se7en) │
│ Devonte Stamm │ Lizzie Murphy       │ Seven (a.k.a. Se7en) │
│ Devonte Stamm │ Edmund Mueller      │ Seven (a.k.a. Se7en) │
│ Devonte Stamm │ Ocie Nikolaus       │ Seven (a.k.a. Se7en) │
│ Devonte Stamm │ Zachariah Nolan     │ Seven (a.k.a. Se7en) │
│ Devonte Stamm │ Enid Stanton        │ Seven (a.k.a. Se7en) │
└───────────────┴─────────────────────┴──────────────────────┘
 
2. Найти 10 самых старых оценок от разных пользователей, вывести названия фильмов, имена пользователей, оценку, дату отзыва в формате ГГГГ-ММ-ДД.
--------------------------------------------------
┌────────────────────────────────┬──────────────────┬────────┬─────────────┐
│        Название фильма         │ Имя пользователя │ Оценка │ Дата отзыва │
├────────────────────────────────┼──────────────────┼────────┼─────────────┤
│ Toy Story                      │ Wanda Kub        │ 4      │ 1996-04-12  │
│ Jumanji                        │ Wanda Kub        │ 5      │ 1996-04-12  │
│ Father of the Bride Part II    │ Wanda Kub        │ 4      │ 1996-04-12  │
│ American President, The        │ Wanda Kub        │ 5      │ 1996-04-12  │
│ Mr. Holland's Opus             │ Wanda Kub        │ 5      │ 1996-04-12  │
│ Happy Gilmore                  │ Wanda Kub        │ 3      │ 1996-04-12  │
│ Bridges of Madison County, The │ Wanda Kub        │ 4      │ 1996-04-12  │
│ Up Close and Personal          │ Wanda Kub        │ 4      │ 1996-04-12  │
│ Birdcage, The                  │ Wanda Kub        │ 5      │ 1996-04-12  │
│ GoldenEye                      │ Stuart Schiller  │ 4      │ 1996-04-18  │
└────────────────────────────────┴──────────────────┴────────┴─────────────┘
 
3. Вывести в одном списке все фильмы с максимальным средним рейтингом и все фильмы с минимальным средним рейтингом. Общий список отсортировать по году выпуска и названию фильма. В зависимости от рейтинга в колонке Рекомендуем для фильмов должно быть написано Да или Нет.
--------------------------------------------------
┌───────────────────────────────────────────────────────────────────────────────────────────┬──────┬─────────────────┬─────────────┐
│                                      Название фильма                                      │ Год  │ Средний рейтинг │ Рекомендуем │
├───────────────────────────────────────────────────────────────────────────────────────────┼──────┼─────────────────┼─────────────┤
│ Black Mirror                                                                              │      │ 5.0             │ Да          │
│ Death Note: Desu nôto (2006–2007)                                                         │      │ 5.0             │ Да          │
│ Runaway Brain (1995)                                                                      │      │ 5.0             │ Да          │
│ The Adventures of Sherlock Holmes and Doctor Watson                                       │      │ 5.0             │ Да          │
│ Man with the Movie Camera, The (Chelovek s kino-apparatom)                                │ 1929 │ 5.0             │ Да          │
│ All Quiet on the Western Front                                                            │ 1930 │ 5.0             │ Да          │
│ Girls About Town                                                                          │ 1931 │ 5.0             │ Да          │
│ Gulliver's Travels                                                                        │ 1939 │ 5.0             │ Да          │
│ Chump at Oxford, A                                                                        │ 1940 │ 5.0             │ Да          │
│ Down Argentine Way                                                                        │ 1940 │ 5.0             │ Да          │
│ Saboteur                                                                                  │ 1942 │ 5.0             │ Да          │
│ Tales of Manhattan                                                                        │ 1942 │ 5.0             │ Да          │
│ To Be or Not to Be                                                                        │ 1942 │ 0.5             │ Нет         │
│ Lifeboat                                                                                  │ 1944 │ 5.0             │ Да          │
│ Big Sleep, The                                                                            │ 1946 │ 5.0             │ Да          │
│ Key Largo                                                                                 │ 1948 │ 5.0             │ Да          │
│ All the King's Men                                                                        │ 1949 │ 5.0             │ Да          │
│ High Noon                                                                                 │ 1952 │ 5.0             │ Да          │
│ Strada, La                                                                                │ 1954 │ 5.0             │ Да          │
│ Man Who Knew Too Much, The                                                                │ 1956 │ 5.0             │ Да          │
│ Searchers, The                                                                            │ 1956 │ 5.0             │ Да          │
│ The Girls                                                                                 │ 1961 │ 5.0             │ Да          │
│ Gypsy                                                                                     │ 1962 │ 0.5             │ Нет         │
│ Ivan's Childhood (a.k.a. My Name is Ivan) (Ivanovo detstvo)                               │ 1962 │ 5.0             │ Да          │
│ Trial, The (Procès, Le)                                                                   │ 1962 │ 5.0             │ Да          │
│ What Ever Happened to Baby Jane?                                                          │ 1962 │ 5.0             │ Да          │
│ Goodbye Charlie                                                                           │ 1964 │ 5.0             │ Да          │
│ Obsession                                                                                 │ 1965 │ 5.0             │ Да          │
│ Repulsion                                                                                 │ 1965 │ 5.0             │ Да          │
│ Vovka in the Kingdom of Far Far Away                                                      │ 1965 │ 5.0             │ Да          │
│ Follow Me, Boys!                                                                          │ 1966 │ 0.5             │ Нет         │
│ It's the Great Pumpkin, Charlie Brown                                                     │ 1966 │ 5.0             │ Да          │
│ Man and a Woman, A (Un homme et une femme)                                                │ 1966 │ 5.0             │ Да          │
│ Who's Afraid of Virginia Woolf?                                                           │ 1966 │ 5.0             │ Да          │
│ Doctor Dolittle                                                                           │ 1967 │ 5.0             │ Да          │
│ Guess Who's Coming to Dinner                                                              │ 1967 │ 5.0             │ Да          │
│ Oscar                                                                                     │ 1967 │ 5.0             │ Да          │
│ Play Time (a.k.a. Playtime)                                                               │ 1967 │ 5.0             │ Да          │
│ To Sir with Love                                                                          │ 1967 │ 5.0             │ Да          │
│ Junior and Karlson                                                                        │ 1968 │ 5.0             │ Да          │
│ Thomas Crown Affair, The                                                                  │ 1968 │ 5.0             │ Да          │
│ Gena the Crocodile                                                                        │ 1969 │ 5.0             │ Да          │
│ The Bremen Town Musicians                                                                 │ 1969 │ 5.0             │ Да          │
│ True Grit                                                                                 │ 1969 │ 5.0             │ Да          │
│ Winnie Pooh                                                                               │ 1969 │ 5.0             │ Да          │
│ Karlson Returns                                                                           │ 1970 │ 5.0             │ Да          │
│ Cheburashka                                                                               │ 1971 │ 5.0             │ Да          │
│ Little Murders                                                                            │ 1971 │ 5.0             │ Да          │
│ Shaft                                                                                     │ 1971 │ 5.0             │ Да          │
│ Winnie the Pooh Goes Visiting                                                             │ 1971 │ 5.0             │ Да          │
│ Jeremiah Johnson                                                                          │ 1972 │ 5.0             │ Да          │
│ Trinity and Sartana Are Coming                                                            │ 1972 │ 5.0             │ Да          │
│ Winnie the Pooh and the Day of Concern                                                    │ 1972 │ 5.0             │ Да          │
│ Fantastic Planet, The (Planète sauvage, La)                                               │ 1973 │ 5.0             │ Да          │
│ Harder They Come, The                                                                     │ 1973 │ 5.0             │ Да          │
│ On the Trail of the Bremen Town Musicians                                                 │ 1973 │ 5.0             │ Да          │
│ Alice Doesn't Live Here Anymore                                                           │ 1974 │ 5.0             │ Да          │
│ Odessa File, The                                                                          │ 1974 │ 5.0             │ Да          │
│ Death Race 2000                                                                           │ 1975 │ 5.0             │ Да          │
│ Love and Death                                                                            │ 1975 │ 5.0             │ Да          │
│ Passenger, The (Professione: reporter)                                                    │ 1975 │ 5.0             │ Да          │
│ Shampoo                                                                                   │ 1975 │ 5.0             │ Да          │
│ 12 Chairs                                                                                 │ 1976 │ 5.0             │ Да          │
│ Bobik Visiting Barbos                                                                     │ 1977 │ 5.0             │ Да          │
│ Christmas Carol, A                                                                        │ 1977 │ 0.5             │ Нет         │
│ Suspiria                                                                                  │ 1977 │ 5.0             │ Да          │
│ Autumn Sonata (Höstsonaten)                                                               │ 1978 │ 5.0             │ Да          │
│ Three from Prostokvashino                                                                 │ 1978 │ 5.0             │ Да          │
│ Marriage of Maria Braun, The (Ehe der Maria Braun, Die)                                   │ 1979 │ 5.0             │ Да          │
│ Moscow Does Not Believe in Tears (Moskva slezam ne verit)                                 │ 1979 │ 5.0             │ Да          │
│ Priklyucheniya Kapitana Vrungelya                                                         │ 1979 │ 5.0             │ Да          │
│ Scooby-Doo Goes Hollywood                                                                 │ 1979 │ 5.0             │ Да          │
│ Sherlock Holmes and Dr. Watson: Acquaintance                                              │ 1979 │ 5.0             │ Да          │
│ The Adventures of Sherlock Holmes and Dr. Watson: Bloody Signature                        │ 1979 │ 5.0             │ Да          │
│ Alien Contamination                                                                       │ 1980 │ 5.0             │ Да          │
│ Altered States                                                                            │ 1980 │ 5.0             │ Да          │
│ Hangar 18                                                                                 │ 1980 │ 5.0             │ Да          │
│ Ordinary People                                                                           │ 1980 │ 5.0             │ Да          │
│ Saturn 3                                                                                  │ 1980 │ 5.0             │ Да          │
│ The Adventures of Sherlock Holmes and Doctor Watson: King of Blackmailers                 │ 1980 │ 5.0             │ Да          │
│ Vacations in Prostokvashino                                                               │ 1980 │ 5.0             │ Да          │
│ A Plasticine Crow                                                                         │ 1981 │ 5.0             │ Да          │
│ Galaxy of Terror (Quest)                                                                  │ 1981 │ 5.0             │ Да          │
│ Mephisto                                                                                  │ 1981 │ 5.0             │ Да          │
│ Mystery of the Third Planet, The (Tayna tretey planety)                                   │ 1981 │ 5.0             │ Да          │
│ Amityville II: The Possession                                                             │ 1982 │ 0.5             │ Нет         │
│ Android                                                                                   │ 1982 │ 5.0             │ Да          │
│ Monty Python Live at the Hollywood Bowl                                                   │ 1982 │ 5.0             │ Да          │
│ Sophie's Choice                                                                           │ 1982 │ 5.0             │ Да          │
│ There Once Was a Dog                                                                      │ 1982 │ 5.0             │ Да          │
│ Last Year's Snow Was Falling                                                              │ 1983 │ 5.0             │ Да          │
│ Never Say Never Again                                                                     │ 1983 │ 5.0             │ Да          │
│ Terms of Endearment                                                                       │ 1983 │ 5.0             │ Да          │
│ The Adventures of Sherlock Holmes and Doctor Watson: The Treasures of Agra                │ 1983 │ 5.0             │ Да          │
│ Travels of an Ant                                                                         │ 1983 │ 5.0             │ Да          │
│ Wow! A Talking Fish!                                                                      │ 1983 │ 5.0             │ Да          │
│ Broadway Danny Rose                                                                       │ 1984 │ 5.0             │ Да          │
│ Cruel Romance, A (Zhestokij Romans)                                                       │ 1984 │ 5.0             │ Да          │
│ Formula of Love                                                                           │ 1984 │ 5.0             │ Да          │
│ In the blue sea, in the white foam.                                                       │ 1984 │ 5.0             │ Да          │
│ Meantime                                                                                  │ 1984 │ 5.0             │ Да          │
│ Night of the Comet                                                                        │ 1984 │ 5.0             │ Да          │
│ Winter in Prostokvashino                                                                  │ 1984 │ 5.0             │ Да          │
│ Chorus Line, A                                                                            │ 1985 │ 5.0             │ Да          │
│ Love and Pigeons                                                                          │ 1985 │ 5.0             │ Да          │
│ 52 Pick-Up                                                                                │ 1986 │ 5.0             │ Да          │
│ Adventures Of Sherlock Holmes And Dr. Watson: The Twentieth Century Approaches            │ 1986 │ 5.0             │ Да          │
│ Fugitives                                                                                 │ 1986 │ 5.0             │ Да          │
│ Investigation Held by Kolobki                                                             │ 1986 │ 5.0             │ Да          │
│ Jean de Florette                                                                          │ 1986 │ 5.0             │ Да          │
│ Willy/Milly                                                                               │ 1986 │ 5.0             │ Да          │
│ Wings, Legs and Tails                                                                     │ 1986 │ 5.0             │ Да          │
│ Babette's Feast (Babettes gæstebud)                                                       │ 1987 │ 5.0             │ Да          │
│ Claymation Christmas Celebration, A                                                       │ 1987 │ 0.5             │ Нет         │
│ Eddie Murphy Raw                                                                          │ 1987 │ 5.0             │ Да          │
│ Harry and the Hendersons                                                                  │ 1987 │ 5.0             │ Да          │
│ Bright Lights, Big City                                                                   │ 1988 │ 5.0             │ Да          │
│ Grave of the Fireflies (Hotaru no haka)                                                   │ 1988 │ 5.0             │ Да          │
│ Great Outdoors, The                                                                       │ 1988 │ 5.0             │ Да          │
│ Hellbound: Hellraiser II                                                                  │ 1988 │ 5.0             │ Да          │
│ Hollywood Chainsaw Hookers                                                                │ 1988 │ 5.0             │ Да          │
│ Light Years (Gandahar)                                                                    │ 1988 │ 5.0             │ Да          │
│ Return to Treasure Island                                                                 │ 1988 │ 5.0             │ Да          │
│ Story of Women (Affaire de femmes, Une)                                                   │ 1988 │ 5.0             │ Да          │
│ Unbearable Lightness of Being, The                                                        │ 1988 │ 5.0             │ Да          │
│ Always                                                                                    │ 1989 │ 5.0             │ Да          │
│ Decalogue, The (Dekalog)                                                                  │ 1989 │ 5.0             │ Да          │
│ UHF                                                                                       │ 1989 │ 5.0             │ Да          │
│ Akira Kurosawa's Dreams (Dreams)                                                          │ 1990 │ 5.0             │ Да          │
│ Europa Europa (Hitlerjunge Salomon)                                                       │ 1990 │ 5.0             │ Да          │
│ Joe Versus the Volcano                                                                    │ 1990 │ 5.0             │ Да          │
│ Paris Is Burning                                                                          │ 1990 │ 5.0             │ Да          │
│ Troll 2                                                                                   │ 1990 │ 5.0             │ Да          │
│ World of Glory                                                                            │ 1991 │ 5.0             │ Да          │
│ George Carlin: Jammin' in New York                                                        │ 1992 │ 5.0             │ Да          │
│ Indochine                                                                                 │ 1992 │ 5.0             │ Да          │
│ Man Bites Dog (C'est arrivé près de chez vous)                                            │ 1992 │ 5.0             │ Да          │
│ The Godfather Trilogy: 1972-1990                                                          │ 1992 │ 5.0             │ Да          │
│ Bill Hicks: Revelations                                                                   │ 1993 │ 5.0             │ Да          │
│ Farewell My Concubine (Ba wang bie ji)                                                    │ 1993 │ 5.0             │ Да          │
│ My Life                                                                                   │ 1993 │ 5.0             │ Да          │
│ RoboCop 3                                                                                 │ 1993 │ 5.0             │ Да          │
│ A Flintstones Christmas Carol                                                             │ 1994 │ 5.0             │ Да          │
│ Lamerica                                                                                  │ 1994 │ 5.0             │ Да          │
│ Lassie                                                                                    │ 1994 │ 5.0             │ Да          │
│ Lesson Faust                                                                              │ 1994 │ 5.0             │ Да          │
│ Lightning Jack                                                                            │ 1994 │ 5.0             │ Да          │
│ Stand, The                                                                                │ 1994 │ 5.0             │ Да          │
│ Angels and Insects                                                                        │ 1995 │ 5.0             │ Да          │
│ Anne Frank Remembered                                                                     │ 1995 │ 5.0             │ Да          │
│ Antonia's Line (Antonia)                                                                  │ 1995 │ 5.0             │ Да          │
│ Canadian Bacon                                                                            │ 1995 │ 5.0             │ Да          │
│ Jerky Boys, The                                                                           │ 1995 │ 0.5             │ Нет         │
│ Operation Dumbo Drop                                                                      │ 1995 │ 0.5             │ Нет         │
│ Children of the Corn IV: The Gathering                                                    │ 1996 │ 5.0             │ Да          │
│ Entertaining Angels: The Dorothy Day Story                                                │ 1996 │ 5.0             │ Да          │
│ Flirting With Disaster                                                                    │ 1996 │ 5.0             │ Да          │
│ Freeway                                                                                   │ 1996 │ 5.0             │ Да          │
│ George Carlin: Back in Town                                                               │ 1996 │ 5.0             │ Да          │
│ Hamlet                                                                                    │ 1996 │ 5.0             │ Да          │
│ Hard Core Logo                                                                            │ 1996 │ 5.0             │ Да          │
│ Jane Eyre                                                                                 │ 1996 │ 5.0             │ Да          │
│ Ponette                                                                                   │ 1996 │ 5.0             │ Да          │
│ Preacher's Wife, The                                                                      │ 1996 │ 5.0             │ Да          │
│ Secrets & Lies                                                                            │ 1996 │ 5.0             │ Да          │
│ Tenchi Muyô! In Love                                                                      │ 1996 │ 5.0             │ Да          │
│ Assignment, The                                                                           │ 1997 │ 5.0             │ Да          │
│ Brother (Brat)                                                                            │ 1997 │ 5.0             │ Да          │
│ Geri's Game                                                                               │ 1997 │ 5.0             │ Да          │
│ Good Burger                                                                               │ 1997 │ 0.5             │ Нет         │
│ Mrs. Dalloway                                                                             │ 1997 │ 5.0             │ Да          │
│ Spice World                                                                               │ 1997 │ 0.5             │ Нет         │
│ The Love Bug                                                                              │ 1997 │ 5.0             │ Да          │
│ Black Cat, White Cat (Crna macka, beli macor)                                             │ 1998 │ 5.0             │ Да          │
│ Central Station (Central do Brasil)                                                       │ 1998 │ 5.0             │ Да          │
│ Everest                                                                                   │ 1998 │ 5.0             │ Да          │
│ Newton Boys, The                                                                          │ 1998 │ 5.0             │ Да          │
│ SLC Punk!                                                                                 │ 1998 │ 5.0             │ Да          │
│ Show Me Love (Fucking Åmål)                                                               │ 1998 │ 5.0             │ Да          │
│ Taxi                                                                                      │ 1998 │ 5.0             │ Да          │
│ All About My Mother (Todo sobre mi madre)                                                 │ 1999 │ 5.0             │ Да          │
│ Cookie's Fortune                                                                          │ 1999 │ 5.0             │ Да          │
│ Eddie Izzard: Dress to Kill                                                               │ 1999 │ 5.0             │ Да          │
│ Five Senses, The                                                                          │ 1999 │ 5.0             │ Да          │
│ Flawless                                                                                  │ 1999 │ 5.0             │ Да          │
│ George Carlin: You Are All Diseased                                                       │ 1999 │ 5.0             │ Да          │
│ Mickey's Once Upon a Christmas                                                            │ 1999 │ 5.0             │ Да          │
│ Siam Sunset                                                                               │ 1999 │ 5.0             │ Да          │
│ Sun Alley (Sonnenallee)                                                                   │ 1999 │ 5.0             │ Да          │
│ Dune                                                                                      │ 2000 │ 5.0             │ Да          │
│ Ginger Snaps                                                                              │ 2000 │ 5.0             │ Да          │
│ I'm the One That I Want                                                                   │ 2000 │ 5.0             │ Да          │
│ Pokémon the Movie 2000                                                                    │ 2000 │ 0.5             │ Нет         │
│ Princess and the Warrior, The (Krieger und die Kaiserin, Der)                             │ 2000 │ 5.0             │ Да          │
│ Rugrats in Paris: The Movie                                                               │ 2000 │ 0.5             │ Нет         │
│ Saving Grace                                                                              │ 2000 │ 5.0             │ Да          │
│ Where the Money Is                                                                        │ 2000 │ 5.0             │ Да          │
│ Iris                                                                                      │ 2001 │ 5.0             │ Да          │
│ Joy Ride                                                                                  │ 2001 │ 0.5             │ Нет         │
│ L.I.E.                                                                                    │ 2001 │ 5.0             │ Да          │
│ Life as a House                                                                           │ 2001 │ 5.0             │ Да          │
│ Lovely & Amazing                                                                          │ 2001 │ 5.0             │ Да          │
│ Metropolis                                                                                │ 2001 │ 5.0             │ Да          │
│ Mutant Aliens                                                                             │ 2001 │ 5.0             │ Да          │
│ My Life as McDull (Mak dau goo si)                                                        │ 2001 │ 5.0             │ Да          │
│ My Sassy Girl (Yeopgijeogin geunyeo)                                                      │ 2001 │ 5.0             │ Да          │
│ No Man's Land                                                                             │ 2001 │ 5.0             │ Да          │
│ Pokémon 3: The Movie                                                                      │ 2001 │ 0.5             │ Нет         │
│ Rivers and Tides                                                                          │ 2001 │ 5.0             │ Да          │
│ Sisters (Syostry)                                                                         │ 2001 │ 5.0             │ Да          │
│ Thirteen Conversations About One Thing (a.k.a. 13 Conversations)                          │ 2001 │ 5.0             │ Да          │
│ Waking Life                                                                               │ 2001 │ 5.0             │ Да          │
│ It's a Very Merry Muppet Christmas Movie                                                  │ 2002 │ 0.5             │ Нет         │
│ Magdalene Sisters, The                                                                    │ 2002 │ 5.0             │ Да          │
│ My Left Eye Sees Ghosts (Ngo joh aan gin diy gwai)                                        │ 2002 │ 5.0             │ Да          │
│ Pokemon 4 Ever (a.k.a. Pokémon 4: The Movie)                                              │ 2002 │ 0.5             │ Нет         │
│ Solaris                                                                                   │ 2002 │ 5.0             │ Да          │
│ Spy Kids 2: The Island of Lost Dreams                                                     │ 2002 │ 0.5             │ Нет         │
│ Stuart Little 2                                                                           │ 2002 │ 5.0             │ Да          │
│ Tuxedo, The                                                                               │ 2002 │ 5.0             │ Да          │
│ Whale Rider                                                                               │ 2002 │ 5.0             │ Да          │
│ Dogville                                                                                  │ 2003 │ 5.0             │ Да          │
│ Duplex                                                                                    │ 2003 │ 5.0             │ Да          │
│ Pokémon Heroes                                                                            │ 2003 │ 0.5             │ Нет         │
│ Stitch! The Movie                                                                         │ 2003 │ 5.0             │ Да          │
│ Texas Chainsaw Massacre, The                                                              │ 2003 │ 0.5             │ Нет         │
│ After the Sunset                                                                          │ 2004 │ 5.0             │ Да          │
│ Alesha Popovich and Tugarin the Dragon                                                    │ 2004 │ 5.0             │ Да          │
│ Calcium Kid, The                                                                          │ 2004 │ 5.0             │ Да          │
│ Dylan Moran: Monster                                                                      │ 2004 │ 5.0             │ Да          │
│ First Daughter                                                                            │ 2004 │ 5.0             │ Да          │
│ Garfield: The Movie                                                                       │ 2004 │ 5.0             │ Да          │
│ Go for Zucker! (Alles auf Zucker!)                                                        │ 2004 │ 5.0             │ Да          │
│ Scooby-Doo! and the Loch Ness Monster                                                     │ 2004 │ 5.0             │ Да          │
│ Aristocrats, The                                                                          │ 2005 │ 5.0             │ Да          │
│ Boy Eats Girl                                                                             │ 2005 │ 5.0             │ Да          │
│ Films to Keep You Awake: The Christmas Tale (Películas para no dormir: Cuento de navidad) │ 2005 │ 0.5             │ Нет         │
│ George Carlin: Life Is Worth Losing                                                       │ 2005 │ 5.0             │ Да          │
│ Guy X                                                                                     │ 2005 │ 5.0             │ Да          │
│ Mrs. Henderson Presents                                                                   │ 2005 │ 0.5             │ Нет         │
│ Stuart Little 3: Call of the Wild                                                         │ 2005 │ 5.0             │ Да          │
│ The Eye: Infinity                                                                         │ 2005 │ 5.0             │ Да          │
│ Asterix and the Vikings (Astérix et les Vikings)                                          │ 2006 │ 5.0             │ Да          │
│ Breed, The                                                                                │ 2006 │ 5.0             │ Да          │
│ Deliver Us from Evil                                                                      │ 2006 │ 5.0             │ Да          │
│ Jackass Number Two                                                                        │ 2006 │ 5.0             │ Да          │
│ Lady in the Water                                                                         │ 2006 │ 0.5             │ Нет         │
│ My Love                                                                                   │ 2006 │ 5.0             │ Да          │
│ Once                                                                                      │ 2006 │ 5.0             │ Да          │
│ Scary Movie 4                                                                             │ 2006 │ 0.5             │ Нет         │
│ The Fox and the Hound 2                                                                   │ 2006 │ 5.0             │ Да          │
│ Tom and Jerry: Shiver Me Whiskers                                                         │ 2006 │ 5.0             │ Да          │
│ Ugly Duckling and Me!, The                                                                │ 2006 │ 5.0             │ Да          │
│ Valet, The (La doublure)                                                                  │ 2006 │ 5.0             │ Да          │
│ Control                                                                                   │ 2007 │ 5.0             │ Да          │
│ Empties                                                                                   │ 2007 │ 5.0             │ Да          │
│ Hannibal Rising                                                                           │ 2007 │ 5.0             │ Да          │
│ Heima                                                                                     │ 2007 │ 5.0             │ Да          │
│ Jackass 2.5                                                                               │ 2007 │ 5.0             │ Да          │
│ Jump In!                                                                                  │ 2007 │ 5.0             │ Да          │
│ King of Kong, The                                                                         │ 2007 │ 5.0             │ Да          │
│ Like Stars on Earth (Taare Zameen Par)                                                    │ 2007 │ 5.0             │ Да          │
│ National Lampoon's Bag Boy                                                                │ 2007 │ 5.0             │ Да          │
│ Reign Over Me                                                                             │ 2007 │ 5.0             │ Да          │
│ Tom and Jerry: A Nutcracker Tale                                                          │ 2007 │ 5.0             │ Да          │
│ Watching the Detectives                                                                   │ 2007 │ 5.0             │ Да          │
│ What Love Is                                                                              │ 2007 │ 5.0             │ Да          │
│ Berlin Calling                                                                            │ 2008 │ 5.0             │ Да          │
│ Cottage, The                                                                              │ 2008 │ 5.0             │ Да          │
│ Front of the Class                                                                        │ 2008 │ 5.0             │ Да          │
│ George Carlin: It's Bad for Ya!                                                           │ 2008 │ 5.0             │ Да          │
│ Man on Wire                                                                               │ 2008 │ 0.5             │ Нет         │
│ Presto                                                                                    │ 2008 │ 5.0             │ Да          │
│ Prom Night                                                                                │ 2008 │ 0.5             │ Нет         │
│ Radio Day                                                                                 │ 2008 │ 5.0             │ Да          │
│ Strictly Sexual                                                                           │ 2008 │ 5.0             │ Да          │
│ Zombie Strippers!                                                                         │ 2008 │ 0.5             │ Нет         │
│ American: The Bill Hicks Story                                                            │ 2009 │ 5.0             │ Да          │
│ Antichrist                                                                                │ 2009 │ 5.0             │ Да          │
│ Fired Up                                                                                  │ 2009 │ 5.0             │ Да          │
│ Garfield's Pet Force                                                                      │ 2009 │ 5.0             │ Да          │
│ Get Low                                                                                   │ 2009 │ 5.0             │ Да          │
│ Home                                                                                      │ 2009 │ 5.0             │ Да          │
│ Human Centipede, The (First Sequence)                                                     │ 2009 │ 0.5             │ Нет         │
│ Jennifer's Body                                                                           │ 2009 │ 0.5             │ Нет         │
│ Scooby-Doo! and the Samurai Sword                                                         │ 2009 │ 5.0             │ Да          │
│ Serious Man, A                                                                            │ 2009 │ 0.5             │ Нет         │
│ Cop Out                                                                                   │ 2010 │ 5.0             │ Да          │
│ Four Lions                                                                                │ 2010 │ 5.0             │ Да          │
│ Get Him to the Greek                                                                      │ 2010 │ 5.0             │ Да          │
│ Let Me In                                                                                 │ 2010 │ 5.0             │ Да          │
│ Miss Nobody                                                                               │ 2010 │ 5.0             │ Да          │
│ Scooby-Doo! Abracadabra-Doo                                                               │ 2010 │ 5.0             │ Да          │
│ Scooby-Doo! Curse of the Lake Monster                                                     │ 2010 │ 5.0             │ Да          │
│ The Man from Nowhere                                                                      │ 2010 │ 5.0             │ Да          │
│ The Pacific                                                                               │ 2010 │ 5.0             │ Да          │
│ What Men Talk About                                                                       │ 2010 │ 5.0             │ Да          │
│ Yogi Bear                                                                                 │ 2010 │ 0.5             │ Нет         │
│ Happy Feet Two                                                                            │ 2011 │ 5.0             │ Да          │
│ Jackass 3.5                                                                               │ 2011 │ 5.0             │ Да          │
│ Just Go with It                                                                           │ 2011 │ 5.0             │ Да          │
│ Melancholia                                                                               │ 2011 │ 5.0             │ Да          │
│ Monsieur Lazhar                                                                           │ 2011 │ 5.0             │ Да          │
│ Snowflake, the White Gorilla                                                              │ 2011 │ 5.0             │ Да          │
│ Spellbound                                                                                │ 2011 │ 5.0             │ Да          │
│ Terri                                                                                     │ 2011 │ 5.0             │ Да          │
│ Your Highness                                                                             │ 2011 │ 5.0             │ Да          │
│ Big Top Scooby-Doo!                                                                       │ 2012 │ 5.0             │ Да          │
│ English Vinglish                                                                          │ 2012 │ 5.0             │ Да          │
│ Fantastic Fear of Everything, A                                                           │ 2012 │ 5.0             │ Да          │
│ Ghost Graduation                                                                          │ 2012 │ 5.0             │ Да          │
│ Hellbenders                                                                               │ 2012 │ 5.0             │ Да          │
│ Maria Bamford: The Special Special Special!                                               │ 2012 │ 0.5             │ Нет         │
│ On the Other Side of the Tracks (De l'autre côté du périph)                               │ 2012 │ 5.0             │ Да          │
│ Rust and Bone (De rouille et d'os)                                                        │ 2012 │ 0.5             │ Нет         │
│ Unicorn City                                                                              │ 2012 │ 5.0             │ Да          │
│ Chinese Puzzle (Casse-tête chinois)                                                       │ 2013 │ 5.0             │ Да          │
│ Craig Ferguson: I'm Here To Help                                                          │ 2013 │ 5.0             │ Да          │
│ Drinking Buddies                                                                          │ 2013 │ 0.5             │ Нет         │
│ Family, The                                                                               │ 2013 │ 5.0             │ Да          │
│ Filth                                                                                     │ 2013 │ 5.0             │ Да          │
│ Garden of Words, The (Koto no ha no niwa)                                                 │ 2013 │ 5.0             │ Да          │
│ Great Beauty, The (Grande Bellezza, La)                                                   │ 2013 │ 5.0             │ Да          │
│ Hunting Elephants                                                                         │ 2013 │ 5.0             │ Да          │
│ Saving Santa                                                                              │ 2013 │ 5.0             │ Да          │
│ Black Mirror: White Christmas                                                             │ 2014 │ 5.0             │ Да          │
│ Haunted House 2, A                                                                        │ 2014 │ 0.5             │ Нет         │
│ Love & Mercy                                                                              │ 2014 │ 5.0             │ Да          │
│ Mr. Peabody & Sherman                                                                     │ 2014 │ 5.0             │ Да          │
│ PK                                                                                        │ 2014 │ 5.0             │ Да          │
│ Predestination                                                                            │ 2014 │ 5.0             │ Да          │
│ The Raid 2: Berandal                                                                      │ 2014 │ 5.0             │ Да          │
│ The Salt of the Earth                                                                     │ 2014 │ 5.0             │ Да          │
│ Tom Segura: Completely Normal                                                             │ 2014 │ 5.0             │ Да          │
│ 10 Cent Pistol                                                                            │ 2015 │ 0.5             │ Нет         │
│ A Perfect Day                                                                             │ 2015 │ 5.0             │ Да          │
│ Bloodsucking Bastards                                                                     │ 2015 │ 5.0             │ Да          │
│ Buzzard                                                                                   │ 2015 │ 5.0             │ Да          │
│ Cosmic Scrat-tastrophe                                                                    │ 2015 │ 5.0             │ Да          │
│ Deathgasm                                                                                 │ 2015 │ 5.0             │ Да          │
│ Fifty Shades of Grey                                                                      │ 2015 │ 0.5             │ Нет         │
│ Human                                                                                     │ 2015 │ 5.0             │ Да          │
│ L.A. Slasher                                                                              │ 2015 │ 5.0             │ Да          │
│ Lumberjack Man                                                                            │ 2015 │ 5.0             │ Да          │
│ Ooops! Noah is Gone...                                                                    │ 2015 │ 5.0             │ Да          │
│ Sorrow                                                                                    │ 2015 │ 0.5             │ Нет         │
│ The Editor                                                                                │ 2015 │ 5.0             │ Да          │
│ The Gracefield Incident                                                                   │ 2015 │ 0.5             │ Нет         │
│ The Jinx: The Life and Deaths of Robert Durst                                             │ 2015 │ 5.0             │ Да          │
│ 13 Hours                                                                                  │ 2016 │ 5.0             │ Да          │
│ All Yours                                                                                 │ 2016 │ 5.0             │ Да          │
│ Bad Santa 2                                                                               │ 2016 │ 0.5             │ Нет         │
│ Central Intelligence                                                                      │ 2016 │ 5.0             │ Да          │
│ Ice Age: The Great Egg-Scapade                                                            │ 2016 │ 5.0             │ Да          │
│ Satanic                                                                                   │ 2016 │ 0.5             │ Нет         │
│ Tom Segura: Mostly Stories                                                                │ 2016 │ 5.0             │ Да          │
│ Death Note                                                                                │ 2017 │ 0.5             │ Нет         │
│ Loving Vincent                                                                            │ 2017 │ 5.0             │ Да          │
└───────────────────────────────────────────────────────────────────────────────────────────┴──────┴─────────────────┴─────────────┘
 
4. Вычислить количество оценок и среднюю оценку, которую дали фильмам пользователи-мужчины в период с 2011 по 2014 год.
--------------------------------------------------
┌───────────────────┬────────────────┐
│ Количество оценок │ Средняя оценка │
├───────────────────┼────────────────┤
│ 0                 │                │
└───────────────────┴────────────────┘
 
5. Составить список фильмов с указанием средней оценки и количества пользователей, которые их оценили. Полученный список отсортировать по году выпуска и названиям фильмов. В списке оставить первые 20 записей.
--------------------------------------------------
┌─────────────────────────────────────────────────────┬──────┬────────────────┬───────────────────┐
│                   Название фильма                   │ Год  │ Средняя оценка │ Количество оценок │
├─────────────────────────────────────────────────────┼──────┼────────────────┼───────────────────┤
│ Black Mirror                                        │      │ 5.0            │ 1                 │
│ Death Note: Desu nôto (2006–2007)                   │      │ 5.0            │ 1                 │
│ Generation Iron 2                                   │      │ 3.5            │ 1                 │
│ Maria Bamford: Old Baby                             │      │ 1.0            │ 1                 │
│ Runaway Brain (1995)                                │      │ 5.0            │ 1                 │
│ The Adventures of Sherlock Holmes and Doctor Watson │      │ 5.0            │ 1                 │
│ Trip to the Moon, A (Voyage dans la lune, Le)       │ 1902 │ 4.0            │ 2                 │
│ The Electric Hotel                                  │ 1908 │ 4.0            │ 1                 │
│ 20,000 Leagues Under the Sea                        │ 1916 │ 4.0            │ 1                 │
│ Rink, The                                           │ 1916 │ 3.5            │ 1                 │
│ Immigrant, The                                      │ 1917 │ 4.5            │ 1                 │
│ One Week                                            │ 1920 │ 3.5            │ 1                 │
│ Kid, The                                            │ 1921 │ 4.5            │ 1                 │
│ Nosferatu (Nosferatu, eine Symphonie des Grauens)   │ 1922 │ 3.8            │ 5                 │
│ Safety Last!                                        │ 1923 │ 3.0            │ 1                 │
│ Battleship Potemkin                                 │ 1925 │ 4.0            │ 1                 │
│ Gold Rush, The                                      │ 1925 │ 4.25           │ 2                 │
│ General, The                                        │ 1926 │ 3.5            │ 5                 │
│ Cat and the Canary, The                             │ 1927 │ 3.0            │ 1                 │
│ Lodger: A Story of the London Fog, The              │ 1927 │ 3.0            │ 1                 │
└─────────────────────────────────────────────────────┴──────┴────────────────┴───────────────────┘
 
6. Определить самый распространенный жанр фильма и количество фильмов в этом жанре. Отдельную таблицу для жанров не использовать, жанры нужно извлекать из таблицы movies.
--------------------------------------------------
┌─────────────────────────────┬────────────────────┐
│ Самый распространенный жанр │ Количество фильмов │
├─────────────────────────────┼────────────────────┤
│ Drama                       │ 4361               │
└─────────────────────────────┴────────────────────┘
Execution fails
--------------------------------------------------
Total ok: 2
Total error: 1
--------------------------------------------------
/home/andrey/labs/DB/304_DB_Migachev_IP
Task04
Task from branch: Task04
Creation date: 10/31/2025 07:19:58
To github.com-mrsu:andpop-mrsu/304_DB_Migachev_IP.git
To github.com-mrsu:andpop-mrsu/304_DB_Migachev_IP.git
   ba4169d..c0c9080  master -> master
   ba4169d..c0c9080  master -> master
304_DB_Moiseev_OM
304_DB_Nepyanova_AP
304_DB_Pazuhina_AK
304_DB_Piganov_DM
=====================================================
/home/andrey/labs/DB/304_DB_Piganov_DM
Из github.com-mrsu:andpop-mrsu/304_DB_Piganov_DM
Из github.com-mrsu:andpop-mrsu/304_DB_Piganov_DM
 * branch            master     -> FETCH_HEAD
 * branch            master     -> FETCH_HEAD
Уже актуально.
fatal: внешний репозиторий student уже существует
fatal: внешний репозиторий student уже существует
Из https://github.com/maironi/304_DB_Piganov_DM
Из https://github.com/maironi/304_DB_Piganov_DM
 * [новая ветка]     Task04     -> student/Task04
 * [новая ветка]     Task04     -> student/Task04
Merge made by the 'recursive' strategy.
 Task04/db_init.sql      | 33177 ++++++++++++++++++++++++++++++++++++++++++++++
 Task04/movies_rating.db |   Bin 0 -> 1138688 bytes
 Task04/task4.bat        |    44 +
 3 files changed, 33221 insertions(+)
 create mode 100644 Task04/db_init.sql
 create mode 100644 Task04/movies_rating.db
 create mode 100755 Task04/task4.bat
--------------------------------------------------
Task:  /home/andrey/labs/DB/304_DB_Piganov_DM/Task04
--------------------------------------------------
Check path: db_init.sql
--------------------------------------------------
Check path: task4.bat
#!/bin/bash
chcp 65001

sqlite3 movies_rating.db < db_init.sql

echo "1. Найти все пары пользователей, оценивших один и тот же фильм. Устранить дубликаты, проверить отсутствие пар с самим собой. Для каждой пары должны быть указаны имена пользователей и название фильма, который они ценили. В списке оставить первые 100 записей."
echo --------------------------------------------------
sqlite3 movies_rating.db -box -echo "SELECT DISTINCT u1.name AS 'Пользователь 1', u2.name AS 'Пользователь 2', m.title AS 'Название Фильма' FROM ratings r1 JOIN ratings r2 ON r1.movie_id = r2.movie_id AND r1.user_id < r2.user_id JOIN users u1 ON r1.user_id = u1.id JOIN users u2 ON r2.user_id = u2.id JOIN movies m ON r1.movie_id = m.id LIMIT 100"
echo " "

echo "2. Найти 10 самых старых оценок от разных пользователей, вывести названия фильмов, имена пользователей, оценку, дату отзыва в формате ГГГГ-ММ-ДД."
echo --------------------------------------------------
sqlite3 movies_rating.db -box -echo "SELECT m.title AS 'Название фильма' , u.name AS 'Имя', r.rating as 'Оценка', datetime(r.timestamp, 'unixepoch') AS 'Дата Отзыва' FROM ratings r JOIN users u ON r.user_id = u.id JOIN movies m ON r.movie_id = m.id ORDER BY r.timestamp ASC LIMIT 10"
echo " "

echo "3. Вывести в одном списке все фильмы с максимальным средним рейтингом и все фильмы с минимальным средним рейтингом. Общий список отсортировать по году выпуска и названию фильма. В зависимости от рейтинга в колонке 'Рекомендуем' для фильмов должно быть написано 'Да' или 'Нет'."
echo --------------------------------------------------
sqlite3 movies_rating.db -box -echo "WITH avg_ratings AS (SELECT movie_id, AVG(rating) as avg_rating FROM ratings GROUP BY movie_id), max_min AS (SELECT MAX(avg_rating) as max_r, MIN(avg_rating) as min_r FROM avg_ratings) SELECT m.title AS 'Название', m.year AS 'Год', ar.avg_rating AS 'Средний рейтинг', CASE WHEN ar.avg_rating = (SELECT max_r FROM max_min) THEN 'Да' ELSE 'Нет' END AS Рекомендуем FROM movies m JOIN avg_ratings ar ON m.id = ar.movie_id WHERE ar.avg_rating = (SELECT max_r FROM max_min) OR ar.avg_rating = (SELECT min_r FROM max_min) ORDER BY m.year, m.title"
echo " "

echo "4. Вычислить количество оценок и среднюю оценку, которую дали фильмам пользователи-мужчины в период с 2011 по 2014 год."
echo --------------------------------------------------
sqlite3 movies_rating.db -box -echo "SELECT COUNT(*) as 'Количество оценок', AVG(r.rating) as 'Cредняя оценка' FROM ratings r JOIN users u ON r.user_id = u.id WHERE u.gender = 'male' AND strftime('%%Y', datetime(r.timestamp, 'unixepoch')) BETWEEN '2011' AND '2014'"
echo " "

echo "5. Составить список фильмов с указанием средней оценки и количества пользователей, которые их оценили. Полученный список отсортировать по году выпуска и названиям фильмов. В списке оставить первые 20 записей."
echo --------------------------------------------------
sqlite3 movies_rating.db -box -echo "SELECT m.title AS 'Название', m.year AS 'Год', AVG(r.rating) as 'Средний рейтинг', COUNT(DISTINCT r.user_id) as 'Коливество пользователей' FROM movies m LEFT JOIN ratings r ON m.id = r.movie_id GROUP BY m.id, m.title, m.year ORDER BY m.year, m.title LIMIT 20"
echo " "

echo "6. Определить самый распространенный жанр фильма и количество фильмов в этом жанре. Отдельную таблицу для жанров не использовать, жанры нужно извлекать из таблицы movies."
echo --------------------------------------------------
sqlite3 movies_rating.db -box -echo "WITH RECURSIVE split(genre, rest) AS (SELECT '', genres || '|' FROM movies UNION ALL SELECT substr(rest, 1, instr(rest, '|') - 1), substr(rest, instr(rest, '|') + 1) FROM split WHERE rest != ''), genre_counts AS (SELECT trim(genre) as genre, COUNT(*) as count FROM split WHERE genre != '' GROUP BY genre) SELECT genre AS 'Жанр', count AS 'Количество фильмов'  FROM genre_counts ORDER BY count DESC LIMIT 1"
echo " "

echo "7. Вывести список из 10 последних зарегистрированных пользователей в формате 'Фамилия Имя|Дата регистрации' (сначала фамилия, потом имя)."
echo --------------------------------------------------
sqlite3 movies_rating.db -box -echo "SELECT substr(name, instr(name, ' ') + 1) || ' ' || substr(name, 1, instr(name, ' ') - 1) || '|' || register_date AS 'Список последних регистраций' FROM users ORDER BY register_date DESC LIMIT 10"
echo " "

echo "8. С помощью рекурсивного CTE определить, на какие дни недели приходился ваш день рождения в каждом году."
echo --------------------------------------------------
sqlite3 movies_rating.db -box -echo "WITH RECURSIVE birthdays(year, date, day_of_week) AS (SELECT 2005, date('2005-09-03'), strftime('%%w', '2005-09-03') UNION ALL SELECT year + 1, date((year + 1) || '-09-03'), strftime('%%w', date((year + 1) || '-09-03')) FROM birthdays WHERE year < 2025) SELECT year, date, CASE day_of_week WHEN '0' THEN 'Воскресенье' WHEN '1' THEN 'Понедельник' WHEN '2' THEN 'Вторник' WHEN '3' THEN 'Среда' WHEN '4' THEN 'Четверг' WHEN '5' THEN 'Пятница' WHEN '6' THEN 'Суббота' END AS day_name FROM birthdays"
echo " "
--------------------------------------------------
Run: ./task4.bat
1. Найти все пары пользователей, оценивших один и тот же фильм. Устранить дубликаты, проверить отсутствие пар с самим собой. Для каждой пары должны быть указаны имена пользователей и название фильма, который они ценили. В списке оставить первые 100 записей.
--------------------------------------------------
SELECT DISTINCT u1.name AS 'Пользователь 1', u2.name AS 'Пользователь 2', m.title AS 'Название Фильма' FROM ratings r1 JOIN ratings r2 ON r1.movie_id = r2.movie_id AND r1.user_id < r2.user_id JOIN users u1 ON r1.user_id = u1.id JOIN users u2 ON r2.user_id = u2.id JOIN movies m ON r1.movie_id = m.id LIMIT 100
┌────────────────┬─────────────────────┬─────────────────────────────┐
│ Пользователь 1 │   Пользователь 2    │       Название Фильма       │
├────────────────┼─────────────────────┼─────────────────────────────┤
│ Devonte Stamm  │ Immanuel Bode       │ Toy Story (1995)            │
│ Devonte Stamm  │ Holden Lueilwitz    │ Toy Story (1995)            │
│ Devonte Stamm  │ Geovany Ratke       │ Toy Story (1995)            │
│ Devonte Stamm  │ Dina Lindgren       │ Toy Story (1995)            │
│ Devonte Stamm  │ Taya Rath           │ Toy Story (1995)            │
│ Devonte Stamm  │ Eda Steuber         │ Toy Story (1995)            │
│ Devonte Stamm  │ Charlene Medhurst   │ Toy Story (1995)            │
│ Devonte Stamm  │ Estell Dicki        │ Toy Story (1995)            │
│ Devonte Stamm  │ Cora DuBuque        │ Toy Story (1995)            │
│ Devonte Stamm  │ Iliana Lowe         │ Toy Story (1995)            │
│ Devonte Stamm  │ Mario Dibbert       │ Toy Story (1995)            │
│ Devonte Stamm  │ Aiyana Jenkins      │ Toy Story (1995)            │
│ Devonte Stamm  │ Ottilie Hudson      │ Toy Story (1995)            │
│ Devonte Stamm  │ Deonte Hane         │ Toy Story (1995)            │
│ Devonte Stamm  │ Leila Kassulke      │ Toy Story (1995)            │
│ Devonte Stamm  │ Moriah Mohr         │ Toy Story (1995)            │
│ Devonte Stamm  │ Cassandra Powlowski │ Toy Story (1995)            │
│ Devonte Stamm  │ Watson Mohr         │ Toy Story (1995)            │
│ Devonte Stamm  │ Marcus Rau          │ Toy Story (1995)            │
│ Devonte Stamm  │ Ocie Nikolaus       │ Toy Story (1995)            │
│ Devonte Stamm  │ Zachariah Nolan     │ Toy Story (1995)            │
│ Devonte Stamm  │ Enid Stanton        │ Toy Story (1995)            │
│ Devonte Stamm  │ Alaina Beatty       │ Toy Story (1995)            │
│ Devonte Stamm  │ Ed Gislason         │ Toy Story (1995)            │
│ Devonte Stamm  │ Albertha Littel     │ Toy Story (1995)            │
│ Devonte Stamm  │ Neoma Lowe          │ Toy Story (1995)            │
│ Devonte Stamm  │ Davin Lubowitz      │ Toy Story (1995)            │
│ Devonte Stamm  │ Paolo Dooley        │ Toy Story (1995)            │
│ Devonte Stamm  │ Ona Nader           │ Toy Story (1995)            │
│ Devonte Stamm  │ Zechariah Kuphal    │ Toy Story (1995)            │
│ Devonte Stamm  │ Constance Reynolds  │ Toy Story (1995)            │
│ Devonte Stamm  │ Justus Fadel        │ Toy Story (1995)            │
│ Devonte Stamm  │ Fritz Graham        │ Toy Story (1995)            │
│ Devonte Stamm  │ Francis Deckow      │ Toy Story (1995)            │
│ Devonte Stamm  │ Octavia Mayert      │ Toy Story (1995)            │
│ Devonte Stamm  │ Brigitte Johnston   │ Toy Story (1995)            │
│ Devonte Stamm  │ Wanda Kub           │ Toy Story (1995)            │
│ Devonte Stamm  │ Earlene Marks       │ Toy Story (1995)            │
│ Devonte Stamm  │ Heaven Volkman      │ Toy Story (1995)            │
│ Devonte Stamm  │ Dwight Reichel      │ Grumpier Old Men (1995)     │
│ Devonte Stamm  │ Eda Steuber         │ Grumpier Old Men (1995)     │
│ Devonte Stamm  │ Iliana Lowe         │ Grumpier Old Men (1995)     │
│ Devonte Stamm  │ America Mante       │ Grumpier Old Men (1995)     │
│ Devonte Stamm  │ Ottilie Hudson      │ Grumpier Old Men (1995)     │
│ Devonte Stamm  │ Deonte Hane         │ Grumpier Old Men (1995)     │
│ Devonte Stamm  │ Gabe Bashirian      │ Grumpier Old Men (1995)     │
│ Devonte Stamm  │ Lizzie Murphy       │ Grumpier Old Men (1995)     │
│ Devonte Stamm  │ Zachariah Nolan     │ Grumpier Old Men (1995)     │
│ Devonte Stamm  │ Alaina Beatty       │ Grumpier Old Men (1995)     │
│ Devonte Stamm  │ Justus Fadel        │ Grumpier Old Men (1995)     │
│ Devonte Stamm  │ Hyman Gleichner     │ Grumpier Old Men (1995)     │
│ Devonte Stamm  │ Elwin Turcotte      │ Grumpier Old Men (1995)     │
│ Devonte Stamm  │ Celestino Bergnaum  │ Grumpier Old Men (1995)     │
│ Devonte Stamm  │ Patience Metz       │ Grumpier Old Men (1995)     │
│ Devonte Stamm  │ Dwight Reichel      │ Heat (1995)                 │
│ Devonte Stamm  │ Martina Kertzmann   │ Heat (1995)                 │
│ Devonte Stamm  │ Taya Rath           │ Heat (1995)                 │
│ Devonte Stamm  │ Dayana Wiegand      │ Heat (1995)                 │
│ Devonte Stamm  │ Gail Hintz          │ Heat (1995)                 │
│ Devonte Stamm  │ Savion Upton        │ Heat (1995)                 │
│ Devonte Stamm  │ Iliana Lowe         │ Heat (1995)                 │
│ Devonte Stamm  │ Deonte Hane         │ Heat (1995)                 │
│ Devonte Stamm  │ Leila Kassulke      │ Heat (1995)                 │
│ Devonte Stamm  │ Marcus Rau          │ Heat (1995)                 │
│ Devonte Stamm  │ Edmund Mueller      │ Heat (1995)                 │
│ Devonte Stamm  │ Zachariah Nolan     │ Heat (1995)                 │
│ Devonte Stamm  │ Alaina Beatty       │ Heat (1995)                 │
│ Devonte Stamm  │ Myrtie Gutkowski    │ Heat (1995)                 │
│ Devonte Stamm  │ Paolo Dooley        │ Heat (1995)                 │
│ Devonte Stamm  │ Jamarcus Bailey     │ Heat (1995)                 │
│ Devonte Stamm  │ Justus Fadel        │ Heat (1995)                 │
│ Devonte Stamm  │ Elwin Turcotte      │ Heat (1995)                 │
│ Devonte Stamm  │ Adell Gusikowski    │ Heat (1995)                 │
│ Devonte Stamm  │ Destinee Wolf       │ Heat (1995)                 │
│ Devonte Stamm  │ Earlene Marks       │ Heat (1995)                 │
│ Devonte Stamm  │ Patience Metz       │ Heat (1995)                 │
│ Devonte Stamm  │ Jamel Nader         │ Seven (a.k.a. Se7en) (1995) │
│ Devonte Stamm  │ Dwight Reichel      │ Seven (a.k.a. Se7en) (1995) │
│ Devonte Stamm  │ Pablo Kuhlman       │ Seven (a.k.a. Se7en) (1995) │
│ Devonte Stamm  │ Chester Price       │ Seven (a.k.a. Se7en) (1995) │
│ Devonte Stamm  │ Westley Wisoky      │ Seven (a.k.a. Se7en) (1995) │
│ Devonte Stamm  │ Geovany Ratke       │ Seven (a.k.a. Se7en) (1995) │
│ Devonte Stamm  │ Zella Schamberger   │ Seven (a.k.a. Se7en) (1995) │
│ Devonte Stamm  │ Dina Lindgren       │ Seven (a.k.a. Se7en) (1995) │
│ Devonte Stamm  │ Taya Rath           │ Seven (a.k.a. Se7en) (1995) │
│ Devonte Stamm  │ Eda Steuber         │ Seven (a.k.a. Se7en) (1995) │
│ Devonte Stamm  │ Lyda Friesen        │ Seven (a.k.a. Se7en) (1995) │
│ Devonte Stamm  │ Savion Upton        │ Seven (a.k.a. Se7en) (1995) │
│ Devonte Stamm  │ Madelynn Abshire    │ Seven (a.k.a. Se7en) (1995) │
│ Devonte Stamm  │ Stone Greenholt     │ Seven (a.k.a. Se7en) (1995) │
│ Devonte Stamm  │ America Mante       │ Seven (a.k.a. Se7en) (1995) │
│ Devonte Stamm  │ Ottilie Hudson      │ Seven (a.k.a. Se7en) (1995) │
│ Devonte Stamm  │ Louisa Orn          │ Seven (a.k.a. Se7en) (1995) │
│ Devonte Stamm  │ Watson Mohr         │ Seven (a.k.a. Se7en) (1995) │
│ Devonte Stamm  │ Valentina Turner    │ Seven (a.k.a. Se7en) (1995) │
│ Devonte Stamm  │ Lizzie Murphy       │ Seven (a.k.a. Se7en) (1995) │
│ Devonte Stamm  │ Edmund Mueller      │ Seven (a.k.a. Se7en) (1995) │
│ Devonte Stamm  │ Ocie Nikolaus       │ Seven (a.k.a. Se7en) (1995) │
│ Devonte Stamm  │ Zachariah Nolan     │ Seven (a.k.a. Se7en) (1995) │
│ Devonte Stamm  │ Enid Stanton        │ Seven (a.k.a. Se7en) (1995) │
└────────────────┴─────────────────────┴─────────────────────────────┘
 
2. Найти 10 самых старых оценок от разных пользователей, вывести названия фильмов, имена пользователей, оценку, дату отзыва в формате ГГГГ-ММ-ДД.
--------------------------------------------------
SELECT m.title AS 'Название фильма' , u.name AS 'Имя', r.rating as 'Оценка', datetime(r.timestamp, 'unixepoch') AS 'Дата Отзыва' FROM ratings r JOIN users u ON r.user_id = u.id JOIN movies m ON r.movie_id = m.id ORDER BY r.timestamp ASC LIMIT 10
┌───────────────────────────────────────┬─────────────────┬────────┬─────────────────────┐
│            Название фильма            │       Имя       │ Оценка │     Дата Отзыва     │
├───────────────────────────────────────┼─────────────────┼────────┼─────────────────────┤
│ Toy Story (1995)                      │ Wanda Kub       │ 4.0    │ 1996-04-12 15:19:00 │
│ Jumanji (1995)                        │ Wanda Kub       │ 5.0    │ 1996-04-12 15:19:00 │
│ Father of the Bride Part II (1995)    │ Wanda Kub       │ 4.0    │ 1996-04-12 15:19:00 │
│ American President, The (1995)        │ Wanda Kub       │ 5.0    │ 1996-04-12 15:19:00 │
│ Mr. Holland's Opus (1995)             │ Wanda Kub       │ 5.0    │ 1996-04-12 15:19:00 │
│ Happy Gilmore (1996)                  │ Wanda Kub       │ 3.0    │ 1996-04-12 15:19:00 │
│ Bridges of Madison County, The (1995) │ Wanda Kub       │ 4.0    │ 1996-04-12 15:19:00 │
│ Up Close and Personal (1996)          │ Wanda Kub       │ 4.0    │ 1996-04-12 15:19:00 │
│ Birdcage, The (1996)                  │ Wanda Kub       │ 5.0    │ 1996-04-12 15:19:00 │
│ GoldenEye (1995)                      │ Stuart Schiller │ 4.0    │ 1996-04-18 11:38:34 │
└───────────────────────────────────────┴─────────────────┴────────┴─────────────────────┘
 
3. Вывести в одном списке все фильмы с максимальным средним рейтингом и все фильмы с минимальным средним рейтингом. Общий список отсортировать по году выпуска и названию фильма. В зависимости от рейтинга в колонке 'Рекомендуем' для фильмов должно быть написано 'Да' или 'Нет'.
--------------------------------------------------
WITH avg_ratings AS (SELECT movie_id, AVG(rating) as avg_rating FROM ratings GROUP BY movie_id), max_min AS (SELECT MAX(avg_rating) as max_r, MIN(avg_rating) as min_r FROM avg_ratings) SELECT m.title AS 'Название', m.year AS 'Год', ar.avg_rating AS 'Средний рейтинг', CASE WHEN ar.avg_rating = (SELECT max_r FROM max_min) THEN 'Да' ELSE 'Нет' END AS Рекомендуем FROM movies m JOIN avg_ratings ar ON m.id = ar.movie_id WHERE ar.avg_rating = (SELECT max_r FROM max_min) OR ar.avg_rating = (SELECT min_r FROM max_min) ORDER BY m.year, m.title
┌──────────────────────────────────────────────────────────────────────────────────────────────────┬──────┬─────────────────┬─────────────┐
│                                             Название                                             │ Год  │ Средний рейтинг │ Рекомендуем │
├──────────────────────────────────────────────────────────────────────────────────────────────────┼──────┼─────────────────┼─────────────┤
│ Black Mirror                                                                                     │      │ 5.0             │ Да          │
│ Death Note: Desu nôto (2006–2007)                                                                │      │ 5.0             │ Да          │
│ The Adventures of Sherlock Holmes and Doctor Watson                                              │      │ 5.0             │ Да          │
│ Man with the Movie Camera, The (Chelovek s kino-apparatom) (1929)                                │ 1929 │ 5.0             │ Да          │
│ All Quiet on the Western Front (1930)                                                            │ 1930 │ 5.0             │ Да          │
│ Girls About Town (1931)                                                                          │ 1931 │ 5.0             │ Да          │
│ Gulliver's Travels (1939)                                                                        │ 1939 │ 5.0             │ Да          │
│ Chump at Oxford, A (1940)                                                                        │ 1940 │ 5.0             │ Да          │
│ Down Argentine Way (1940)                                                                        │ 1940 │ 5.0             │ Да          │
│ Saboteur (1942)                                                                                  │ 1942 │ 5.0             │ Да          │
│ Tales of Manhattan (1942)                                                                        │ 1942 │ 5.0             │ Да          │
│ To Be or Not to Be (1942)                                                                        │ 1942 │ 0.5             │ Нет         │
│ Lifeboat (1944)                                                                                  │ 1944 │ 5.0             │ Да          │
│ Big Sleep, The (1946)                                                                            │ 1946 │ 5.0             │ Да          │
│ Key Largo (1948)                                                                                 │ 1948 │ 5.0             │ Да          │
│ All the King's Men (1949)                                                                        │ 1949 │ 5.0             │ Да          │
│ High Noon (1952)                                                                                 │ 1952 │ 5.0             │ Да          │
│ Strada, La (1954)                                                                                │ 1954 │ 5.0             │ Да          │
│ Man Who Knew Too Much, The (1956)                                                                │ 1956 │ 5.0             │ Да          │
│ Searchers, The (1956)                                                                            │ 1956 │ 5.0             │ Да          │
│ The Girls (1961)                                                                                 │ 1961 │ 5.0             │ Да          │
│ Gypsy (1962)                                                                                     │ 1962 │ 0.5             │ Нет         │
│ Ivan's Childhood (a.k.a. My Name is Ivan) (Ivanovo detstvo) (1962)                               │ 1962 │ 5.0             │ Да          │
│ Trial, The (Procès, Le) (1962)                                                                   │ 1962 │ 5.0             │ Да          │
│ What Ever Happened to Baby Jane? (1962)                                                          │ 1962 │ 5.0             │ Да          │
│ Goodbye Charlie (1964)                                                                           │ 1964 │ 5.0             │ Да          │
│ Obsession (1965)                                                                                 │ 1965 │ 5.0             │ Да          │
│ Repulsion (1965)                                                                                 │ 1965 │ 5.0             │ Да          │
│ Vovka in the Kingdom of Far Far Away (1965)                                                      │ 1965 │ 5.0             │ Да          │
│ Follow Me, Boys! (1966)                                                                          │ 1966 │ 0.5             │ Нет         │
│ It's the Great Pumpkin, Charlie Brown (1966)                                                     │ 1966 │ 5.0             │ Да          │
│ Man and a Woman, A (Un homme et une femme) (1966)                                                │ 1966 │ 5.0             │ Да          │
│ Who's Afraid of Virginia Woolf? (1966)                                                           │ 1966 │ 5.0             │ Да          │
│ Doctor Dolittle (1967)                                                                           │ 1967 │ 5.0             │ Да          │
│ Guess Who's Coming to Dinner (1967)                                                              │ 1967 │ 5.0             │ Да          │
│ Oscar (1967)                                                                                     │ 1967 │ 5.0             │ Да          │
│ Play Time (a.k.a. Playtime) (1967)                                                               │ 1967 │ 5.0             │ Да          │
│ To Sir with Love (1967)                                                                          │ 1967 │ 5.0             │ Да          │
│ Junior and Karlson (1968)                                                                        │ 1968 │ 5.0             │ Да          │
│ Thomas Crown Affair, The (1968)                                                                  │ 1968 │ 5.0             │ Да          │
│ Gena the Crocodile (1969)                                                                        │ 1969 │ 5.0             │ Да          │
│ The Bremen Town Musicians (1969)                                                                 │ 1969 │ 5.0             │ Да          │
│ True Grit (1969)                                                                                 │ 1969 │ 5.0             │ Да          │
│ Winnie Pooh (1969)                                                                               │ 1969 │ 5.0             │ Да          │
│ Karlson Returns (1970)                                                                           │ 1970 │ 5.0             │ Да          │
│ Cheburashka (1971)                                                                               │ 1971 │ 5.0             │ Да          │
│ Little Murders (1971)                                                                            │ 1971 │ 5.0             │ Да          │
│ Shaft (1971)                                                                                     │ 1971 │ 5.0             │ Да          │
│ Winnie the Pooh Goes Visiting (1971)                                                             │ 1971 │ 5.0             │ Да          │
│ Jeremiah Johnson (1972)                                                                          │ 1972 │ 5.0             │ Да          │
│ Trinity and Sartana Are Coming (1972)                                                            │ 1972 │ 5.0             │ Да          │
│ Winnie the Pooh and the Day of Concern (1972)                                                    │ 1972 │ 5.0             │ Да          │
│ Fantastic Planet, The (Planète sauvage, La) (1973)                                               │ 1973 │ 5.0             │ Да          │
│ Harder They Come, The (1973)                                                                     │ 1973 │ 5.0             │ Да          │
│ On the Trail of the Bremen Town Musicians (1973)                                                 │ 1973 │ 5.0             │ Да          │
│ Alice Doesn't Live Here Anymore (1974)                                                           │ 1974 │ 5.0             │ Да          │
│ Odessa File, The (1974)                                                                          │ 1974 │ 5.0             │ Да          │
│ Death Race 2000 (1975)                                                                           │ 1975 │ 5.0             │ Да          │
│ Love and Death (1975)                                                                            │ 1975 │ 5.0             │ Да          │
│ Passenger, The (Professione: reporter) (1975)                                                    │ 1975 │ 5.0             │ Да          │
│ Shampoo (1975)                                                                                   │ 1975 │ 5.0             │ Да          │
│ 12 Chairs (1976)                                                                                 │ 1976 │ 5.0             │ Да          │
│ Bobik Visiting Barbos (1977)                                                                     │ 1977 │ 5.0             │ Да          │
│ Christmas Carol, A (1977)                                                                        │ 1977 │ 0.5             │ Нет         │
│ Suspiria (1977)                                                                                  │ 1977 │ 5.0             │ Да          │
│ Autumn Sonata (Höstsonaten) (1978)                                                               │ 1978 │ 5.0             │ Да          │
│ Three from Prostokvashino (1978)                                                                 │ 1978 │ 5.0             │ Да          │
│ Marriage of Maria Braun, The (Ehe der Maria Braun, Die) (1979)                                   │ 1979 │ 5.0             │ Да          │
│ Moscow Does Not Believe in Tears (Moskva slezam ne verit) (1979)                                 │ 1979 │ 5.0             │ Да          │
│ Priklyucheniya Kapitana Vrungelya (1979)                                                         │ 1979 │ 5.0             │ Да          │
│ Scooby-Doo Goes Hollywood (1979)                                                                 │ 1979 │ 5.0             │ Да          │
│ Sherlock Holmes and Dr. Watson: Acquaintance (1979)                                              │ 1979 │ 5.0             │ Да          │
│ The Adventures of Sherlock Holmes and Dr. Watson: Bloody Signature (1979)                        │ 1979 │ 5.0             │ Да          │
│ Alien Contamination (1980)                                                                       │ 1980 │ 5.0             │ Да          │
│ Altered States (1980)                                                                            │ 1980 │ 5.0             │ Да          │
│ Hangar 18 (1980)                                                                                 │ 1980 │ 5.0             │ Да          │
│ Ordinary People (1980)                                                                           │ 1980 │ 5.0             │ Да          │
│ Saturn 3 (1980)                                                                                  │ 1980 │ 5.0             │ Да          │
│ The Adventures of Sherlock Holmes and Doctor Watson: King of Blackmailers (1980)                 │ 1980 │ 5.0             │ Да          │
│ Vacations in Prostokvashino (1980)                                                               │ 1980 │ 5.0             │ Да          │
│ A Plasticine Crow (1981)                                                                         │ 1981 │ 5.0             │ Да          │
│ Galaxy of Terror (Quest) (1981)                                                                  │ 1981 │ 5.0             │ Да          │
│ Mephisto (1981)                                                                                  │ 1981 │ 5.0             │ Да          │
│ Mystery of the Third Planet, The (Tayna tretey planety) (1981)                                   │ 1981 │ 5.0             │ Да          │
│ Amityville II: The Possession (1982)                                                             │ 1982 │ 0.5             │ Нет         │
│ Android (1982)                                                                                   │ 1982 │ 5.0             │ Да          │
│ Monty Python Live at the Hollywood Bowl (1982)                                                   │ 1982 │ 5.0             │ Да          │
│ Sophie's Choice (1982)                                                                           │ 1982 │ 5.0             │ Да          │
│ There Once Was a Dog (1982)                                                                      │ 1982 │ 5.0             │ Да          │
│ Last Year's Snow Was Falling (1983)                                                              │ 1983 │ 5.0             │ Да          │
│ Never Say Never Again (1983)                                                                     │ 1983 │ 5.0             │ Да          │
│ Terms of Endearment (1983)                                                                       │ 1983 │ 5.0             │ Да          │
│ The Adventures of Sherlock Holmes and Doctor Watson: The Treasures of Agra (1983)                │ 1983 │ 5.0             │ Да          │
│ Travels of an Ant (1983)                                                                         │ 1983 │ 5.0             │ Да          │
│ Wow! A Talking Fish! (1983)                                                                      │ 1983 │ 5.0             │ Да          │
│ Broadway Danny Rose (1984)                                                                       │ 1984 │ 5.0             │ Да          │
│ Cruel Romance, A (Zhestokij Romans) (1984)                                                       │ 1984 │ 5.0             │ Да          │
│ Formula of Love (1984)                                                                           │ 1984 │ 5.0             │ Да          │
│ In the blue sea, in the white foam. (1984)                                                       │ 1984 │ 5.0             │ Да          │
│ Meantime (1984)                                                                                  │ 1984 │ 5.0             │ Да          │
│ Night of the Comet (1984)                                                                        │ 1984 │ 5.0             │ Да          │
│ Winter in Prostokvashino (1984)                                                                  │ 1984 │ 5.0             │ Да          │
│ Chorus Line, A (1985)                                                                            │ 1985 │ 5.0             │ Да          │
│ Love and Pigeons (1985)                                                                          │ 1985 │ 5.0             │ Да          │
│ 52 Pick-Up (1986)                                                                                │ 1986 │ 5.0             │ Да          │
│ Adventures Of Sherlock Holmes And Dr. Watson: The Twentieth Century Approaches (1986)            │ 1986 │ 5.0             │ Да          │
│ Fugitives (1986)                                                                                 │ 1986 │ 5.0             │ Да          │
│ Investigation Held by Kolobki (1986)                                                             │ 1986 │ 5.0             │ Да          │
│ Jean de Florette (1986)                                                                          │ 1986 │ 5.0             │ Да          │
│ Willy/Milly (1986)                                                                               │ 1986 │ 5.0             │ Да          │
│ Wings, Legs and Tails (1986)                                                                     │ 1986 │ 5.0             │ Да          │
│ Babette's Feast (Babettes gæstebud) (1987)                                                       │ 1987 │ 5.0             │ Да          │
│ Claymation Christmas Celebration, A (1987)                                                       │ 1987 │ 0.5             │ Нет         │
│ Eddie Murphy Raw (1987)                                                                          │ 1987 │ 5.0             │ Да          │
│ Harry and the Hendersons (1987)                                                                  │ 1987 │ 5.0             │ Да          │
│ Bright Lights, Big City (1988)                                                                   │ 1988 │ 5.0             │ Да          │
│ Grave of the Fireflies (Hotaru no haka) (1988)                                                   │ 1988 │ 5.0             │ Да          │
│ Great Outdoors, The (1988)                                                                       │ 1988 │ 5.0             │ Да          │
│ Hellbound: Hellraiser II (1988)                                                                  │ 1988 │ 5.0             │ Да          │
│ Hollywood Chainsaw Hookers (1988)                                                                │ 1988 │ 5.0             │ Да          │
│ Light Years (Gandahar) (1988)                                                                    │ 1988 │ 5.0             │ Да          │
│ Return to Treasure Island (1988)                                                                 │ 1988 │ 5.0             │ Да          │
│ Story of Women (Affaire de femmes, Une) (1988)                                                   │ 1988 │ 5.0             │ Да          │
│ Unbearable Lightness of Being, The (1988)                                                        │ 1988 │ 5.0             │ Да          │
│ Always (1989)                                                                                    │ 1989 │ 5.0             │ Да          │
│ Decalogue, The (Dekalog) (1989)                                                                  │ 1989 │ 5.0             │ Да          │
│ UHF (1989)                                                                                       │ 1989 │ 5.0             │ Да          │
│ Akira Kurosawa's Dreams (Dreams) (1990)                                                          │ 1990 │ 5.0             │ Да          │
│ Europa Europa (Hitlerjunge Salomon) (1990)                                                       │ 1990 │ 5.0             │ Да          │
│ Joe Versus the Volcano (1990)                                                                    │ 1990 │ 5.0             │ Да          │
│ Paris Is Burning (1990)                                                                          │ 1990 │ 5.0             │ Да          │
│ Troll 2 (1990)                                                                                   │ 1990 │ 5.0             │ Да          │
│ World of Glory (1991)                                                                            │ 1991 │ 5.0             │ Да          │
│ George Carlin: Jammin' in New York (1992)                                                        │ 1992 │ 5.0             │ Да          │
│ Indochine (1992)                                                                                 │ 1992 │ 5.0             │ Да          │
│ Man Bites Dog (C'est arrivé près de chez vous) (1992)                                            │ 1992 │ 5.0             │ Да          │
│ The Godfather Trilogy: 1972-1990 (1992)                                                          │ 1992 │ 5.0             │ Да          │
│ Bill Hicks: Revelations (1993)                                                                   │ 1993 │ 5.0             │ Да          │
│ Farewell My Concubine (Ba wang bie ji) (1993)                                                    │ 1993 │ 5.0             │ Да          │
│ My Life (1993)                                                                                   │ 1993 │ 5.0             │ Да          │
│ RoboCop 3 (1993)                                                                                 │ 1993 │ 5.0             │ Да          │
│ A Flintstones Christmas Carol (1994)                                                             │ 1994 │ 5.0             │ Да          │
│ Lamerica (1994)                                                                                  │ 1994 │ 5.0             │ Да          │
│ Lassie (1994)                                                                                    │ 1994 │ 5.0             │ Да          │
│ Lesson Faust (1994)                                                                              │ 1994 │ 5.0             │ Да          │
│ Lightning Jack (1994)                                                                            │ 1994 │ 5.0             │ Да          │
│ Stand, The (1994)                                                                                │ 1994 │ 5.0             │ Да          │
│ Angels and Insects (1995)                                                                        │ 1995 │ 5.0             │ Да          │
│ Anne Frank Remembered (1995)                                                                     │ 1995 │ 5.0             │ Да          │
│ Antonia's Line (Antonia) (1995)                                                                  │ 1995 │ 5.0             │ Да          │
│ Canadian Bacon (1995)                                                                            │ 1995 │ 5.0             │ Да          │
│ Jerky Boys, The (1995)                                                                           │ 1995 │ 0.5             │ Нет         │
│ Operation Dumbo Drop (1995)                                                                      │ 1995 │ 0.5             │ Нет         │
│ Runaway Brain (1995)                                                                             │ 1995 │ 5.0             │ Да          │
│ Children of the Corn IV: The Gathering (1996)                                                    │ 1996 │ 5.0             │ Да          │
│ Entertaining Angels: The Dorothy Day Story (1996)                                                │ 1996 │ 5.0             │ Да          │
│ Flirting With Disaster (1996)                                                                    │ 1996 │ 5.0             │ Да          │
│ Freeway (1996)                                                                                   │ 1996 │ 5.0             │ Да          │
│ George Carlin: Back in Town (1996)                                                               │ 1996 │ 5.0             │ Да          │
│ Hamlet (1996)                                                                                    │ 1996 │ 5.0             │ Да          │
│ Hard Core Logo (1996)                                                                            │ 1996 │ 5.0             │ Да          │
│ Jane Eyre (1996)                                                                                 │ 1996 │ 5.0             │ Да          │
│ Ponette (1996)                                                                                   │ 1996 │ 5.0             │ Да          │
│ Preacher's Wife, The (1996)                                                                      │ 1996 │ 5.0             │ Да          │
│ Secrets & Lies (1996)                                                                            │ 1996 │ 5.0             │ Да          │
│ Tenchi Muyô! In Love (1996)                                                                      │ 1996 │ 5.0             │ Да          │
│ Assignment, The (1997)                                                                           │ 1997 │ 5.0             │ Да          │
│ Brother (Brat) (1997)                                                                            │ 1997 │ 5.0             │ Да          │
│ Geri's Game (1997)                                                                               │ 1997 │ 5.0             │ Да          │
│ Good Burger (1997)                                                                               │ 1997 │ 0.5             │ Нет         │
│ Mrs. Dalloway (1997)                                                                             │ 1997 │ 5.0             │ Да          │
│ Spice World (1997)                                                                               │ 1997 │ 0.5             │ Нет         │
│ The Love Bug (1997)                                                                              │ 1997 │ 5.0             │ Да          │
│ Black Cat, White Cat (Crna macka, beli macor) (1998)                                             │ 1998 │ 5.0             │ Да          │
│ Central Station (Central do Brasil) (1998)                                                       │ 1998 │ 5.0             │ Да          │
│ Everest (1998)                                                                                   │ 1998 │ 5.0             │ Да          │
│ Newton Boys, The (1998)                                                                          │ 1998 │ 5.0             │ Да          │
│ SLC Punk! (1998)                                                                                 │ 1998 │ 5.0             │ Да          │
│ Show Me Love (Fucking Åmål) (1998)                                                               │ 1998 │ 5.0             │ Да          │
│ Taxi (1998)                                                                                      │ 1998 │ 5.0             │ Да          │
│ All About My Mother (Todo sobre mi madre) (1999)                                                 │ 1999 │ 5.0             │ Да          │
│ Cookie's Fortune (1999)                                                                          │ 1999 │ 5.0             │ Да          │
│ Eddie Izzard: Dress to Kill (1999)                                                               │ 1999 │ 5.0             │ Да          │
│ Five Senses, The (1999)                                                                          │ 1999 │ 5.0             │ Да          │
│ Flawless (1999)                                                                                  │ 1999 │ 5.0             │ Да          │
│ George Carlin: You Are All Diseased (1999)                                                       │ 1999 │ 5.0             │ Да          │
│ Mickey's Once Upon a Christmas (1999)                                                            │ 1999 │ 5.0             │ Да          │
│ Siam Sunset (1999)                                                                               │ 1999 │ 5.0             │ Да          │
│ Sun Alley (Sonnenallee) (1999)                                                                   │ 1999 │ 5.0             │ Да          │
│ Dune (2000)                                                                                      │ 2000 │ 5.0             │ Да          │
│ Ginger Snaps (2000)                                                                              │ 2000 │ 5.0             │ Да          │
│ I'm the One That I Want (2000)                                                                   │ 2000 │ 5.0             │ Да          │
│ Pokémon the Movie 2000 (2000)                                                                    │ 2000 │ 0.5             │ Нет         │
│ Princess and the Warrior, The (Krieger und die Kaiserin, Der) (2000)                             │ 2000 │ 5.0             │ Да          │
│ Rugrats in Paris: The Movie (2000)                                                               │ 2000 │ 0.5             │ Нет         │
│ Saving Grace (2000)                                                                              │ 2000 │ 5.0             │ Да          │
│ Where the Money Is (2000)                                                                        │ 2000 │ 5.0             │ Да          │
│ Iris (2001)                                                                                      │ 2001 │ 5.0             │ Да          │
│ Joy Ride (2001)                                                                                  │ 2001 │ 0.5             │ Нет         │
│ L.I.E. (2001)                                                                                    │ 2001 │ 5.0             │ Да          │
│ Life as a House (2001)                                                                           │ 2001 │ 5.0             │ Да          │
│ Lovely & Amazing (2001)                                                                          │ 2001 │ 5.0             │ Да          │
│ Metropolis (2001)                                                                                │ 2001 │ 5.0             │ Да          │
│ Mutant Aliens (2001)                                                                             │ 2001 │ 5.0             │ Да          │
│ My Life as McDull (Mak dau goo si) (2001)                                                        │ 2001 │ 5.0             │ Да          │
│ My Sassy Girl (Yeopgijeogin geunyeo) (2001)                                                      │ 2001 │ 5.0             │ Да          │
│ No Man's Land (2001)                                                                             │ 2001 │ 5.0             │ Да          │
│ Pokémon 3: The Movie (2001)                                                                      │ 2001 │ 0.5             │ Нет         │
│ Rivers and Tides (2001)                                                                          │ 2001 │ 5.0             │ Да          │
│ Sisters (Syostry) (2001)                                                                         │ 2001 │ 5.0             │ Да          │
│ Thirteen Conversations About One Thing (a.k.a. 13 Conversations) (2001)                          │ 2001 │ 5.0             │ Да          │
│ Waking Life (2001)                                                                               │ 2001 │ 5.0             │ Да          │
│ It's a Very Merry Muppet Christmas Movie (2002)                                                  │ 2002 │ 0.5             │ Нет         │
│ Magdalene Sisters, The (2002)                                                                    │ 2002 │ 5.0             │ Да          │
│ My Left Eye Sees Ghosts (Ngo joh aan gin diy gwai) (2002)                                        │ 2002 │ 5.0             │ Да          │
│ Pokemon 4 Ever (a.k.a. Pokémon 4: The Movie) (2002)                                              │ 2002 │ 0.5             │ Нет         │
│ Solaris (2002)                                                                                   │ 2002 │ 5.0             │ Да          │
│ Spy Kids 2: The Island of Lost Dreams (2002)                                                     │ 2002 │ 0.5             │ Нет         │
│ Stuart Little 2 (2002)                                                                           │ 2002 │ 5.0             │ Да          │
│ Tuxedo, The (2002)                                                                               │ 2002 │ 5.0             │ Да          │
│ Whale Rider (2002)                                                                               │ 2002 │ 5.0             │ Да          │
│ Dogville (2003)                                                                                  │ 2003 │ 5.0             │ Да          │
│ Duplex (2003)                                                                                    │ 2003 │ 5.0             │ Да          │
│ Pokémon Heroes (2003)                                                                            │ 2003 │ 0.5             │ Нет         │
│ Stitch! The Movie (2003)                                                                         │ 2003 │ 5.0             │ Да          │
│ Texas Chainsaw Massacre, The (2003)                                                              │ 2003 │ 0.5             │ Нет         │
│ After the Sunset (2004)                                                                          │ 2004 │ 5.0             │ Да          │
│ Alesha Popovich and Tugarin the Dragon (2004)                                                    │ 2004 │ 5.0             │ Да          │
│ Calcium Kid, The (2004)                                                                          │ 2004 │ 5.0             │ Да          │
│ Dylan Moran: Monster (2004)                                                                      │ 2004 │ 5.0             │ Да          │
│ First Daughter (2004)                                                                            │ 2004 │ 5.0             │ Да          │
│ Garfield: The Movie (2004)                                                                       │ 2004 │ 5.0             │ Да          │
│ Go for Zucker! (Alles auf Zucker!) (2004)                                                        │ 2004 │ 5.0             │ Да          │
│ Scooby-Doo! and the Loch Ness Monster (2004)                                                     │ 2004 │ 5.0             │ Да          │
│ Aristocrats, The (2005)                                                                          │ 2005 │ 5.0             │ Да          │
│ Boy Eats Girl (2005)                                                                             │ 2005 │ 5.0             │ Да          │
│ Films to Keep You Awake: The Christmas Tale (Películas para no dormir: Cuento de navidad) (2005) │ 2005 │ 0.5             │ Нет         │
│ George Carlin: Life Is Worth Losing (2005)                                                       │ 2005 │ 5.0             │ Да          │
│ Guy X (2005)                                                                                     │ 2005 │ 5.0             │ Да          │
│ Mrs. Henderson Presents (2005)                                                                   │ 2005 │ 0.5             │ Нет         │
│ Stuart Little 3: Call of the Wild (2005)                                                         │ 2005 │ 5.0             │ Да          │
│ The Eye: Infinity (2005)                                                                         │ 2005 │ 5.0             │ Да          │
│ Asterix and the Vikings (Astérix et les Vikings) (2006)                                          │ 2006 │ 5.0             │ Да          │
│ Breed, The (2006)                                                                                │ 2006 │ 5.0             │ Да          │
│ Deliver Us from Evil (2006)                                                                      │ 2006 │ 5.0             │ Да          │
│ Jackass Number Two (2006)                                                                        │ 2006 │ 5.0             │ Да          │
│ Lady in the Water (2006)                                                                         │ 2006 │ 0.5             │ Нет         │
│ My Love (2006)                                                                                   │ 2006 │ 5.0             │ Да          │
│ Once (2006)                                                                                      │ 2006 │ 5.0             │ Да          │
│ Scary Movie 4 (2006)                                                                             │ 2006 │ 0.5             │ Нет         │
│ The Fox and the Hound 2 (2006)                                                                   │ 2006 │ 5.0             │ Да          │
│ Tom and Jerry: Shiver Me Whiskers (2006)                                                         │ 2006 │ 5.0             │ Да          │
│ Ugly Duckling and Me!, The (2006)                                                                │ 2006 │ 5.0             │ Да          │
│ Valet, The (La doublure) (2006)                                                                  │ 2006 │ 5.0             │ Да          │
│ Control (2007)                                                                                   │ 2007 │ 5.0             │ Да          │
│ Empties (2007)                                                                                   │ 2007 │ 5.0             │ Да          │
│ Hannibal Rising (2007)                                                                           │ 2007 │ 5.0             │ Да          │
│ Heima (2007)                                                                                     │ 2007 │ 5.0             │ Да          │
│ Jackass 2.5 (2007)                                                                               │ 2007 │ 5.0             │ Да          │
│ Jump In! (2007)                                                                                  │ 2007 │ 5.0             │ Да          │
│ King of Kong, The (2007)                                                                         │ 2007 │ 5.0             │ Да          │
│ Like Stars on Earth (Taare Zameen Par) (2007)                                                    │ 2007 │ 5.0             │ Да          │
│ National Lampoon's Bag Boy (2007)                                                                │ 2007 │ 5.0             │ Да          │
│ Reign Over Me (2007)                                                                             │ 2007 │ 5.0             │ Да          │
│ Tom and Jerry: A Nutcracker Tale (2007)                                                          │ 2007 │ 5.0             │ Да          │
│ Watching the Detectives (2007)                                                                   │ 2007 │ 5.0             │ Да          │
│ What Love Is (2007)                                                                              │ 2007 │ 5.0             │ Да          │
│ Berlin Calling (2008)                                                                            │ 2008 │ 5.0             │ Да          │
│ Cottage, The (2008)                                                                              │ 2008 │ 5.0             │ Да          │
│ Front of the Class (2008)                                                                        │ 2008 │ 5.0             │ Да          │
│ George Carlin: It's Bad for Ya! (2008)                                                           │ 2008 │ 5.0             │ Да          │
│ Man on Wire (2008)                                                                               │ 2008 │ 0.5             │ Нет         │
│ Presto (2008)                                                                                    │ 2008 │ 5.0             │ Да          │
│ Prom Night (2008)                                                                                │ 2008 │ 0.5             │ Нет         │
│ Radio Day (2008)                                                                                 │ 2008 │ 5.0             │ Да          │
│ Strictly Sexual (2008)                                                                           │ 2008 │ 5.0             │ Да          │
│ Zombie Strippers! (2008)                                                                         │ 2008 │ 0.5             │ Нет         │
│ American: The Bill Hicks Story (2009)                                                            │ 2009 │ 5.0             │ Да          │
│ Antichrist (2009)                                                                                │ 2009 │ 5.0             │ Да          │
│ Fired Up (2009)                                                                                  │ 2009 │ 5.0             │ Да          │
│ Garfield's Pet Force (2009)                                                                      │ 2009 │ 5.0             │ Да          │
│ Get Low (2009)                                                                                   │ 2009 │ 5.0             │ Да          │
│ Home (2009)                                                                                      │ 2009 │ 5.0             │ Да          │
│ Human Centipede, The (First Sequence) (2009)                                                     │ 2009 │ 0.5             │ Нет         │
│ Jennifer's Body (2009)                                                                           │ 2009 │ 0.5             │ Нет         │
│ Scooby-Doo! and the Samurai Sword (2009)                                                         │ 2009 │ 5.0             │ Да          │
│ Serious Man, A (2009)                                                                            │ 2009 │ 0.5             │ Нет         │
│ Cop Out (2010)                                                                                   │ 2010 │ 5.0             │ Да          │
│ Four Lions (2010)                                                                                │ 2010 │ 5.0             │ Да          │
│ Get Him to the Greek (2010)                                                                      │ 2010 │ 5.0             │ Да          │
│ Let Me In (2010)                                                                                 │ 2010 │ 5.0             │ Да          │
│ Miss Nobody (2010)                                                                               │ 2010 │ 5.0             │ Да          │
│ Scooby-Doo! Abracadabra-Doo (2010)                                                               │ 2010 │ 5.0             │ Да          │
│ Scooby-Doo! Curse of the Lake Monster (2010)                                                     │ 2010 │ 5.0             │ Да          │
│ The Man from Nowhere (2010)                                                                      │ 2010 │ 5.0             │ Да          │
│ The Pacific (2010)                                                                               │ 2010 │ 5.0             │ Да          │
│ What Men Talk About (2010)                                                                       │ 2010 │ 5.0             │ Да          │
│ Yogi Bear (2010)                                                                                 │ 2010 │ 0.5             │ Нет         │
│ Happy Feet Two (2011)                                                                            │ 2011 │ 5.0             │ Да          │
│ Jackass 3.5 (2011)                                                                               │ 2011 │ 5.0             │ Да          │
│ Just Go with It (2011)                                                                           │ 2011 │ 5.0             │ Да          │
│ Melancholia (2011)                                                                               │ 2011 │ 5.0             │ Да          │
│ Monsieur Lazhar (2011)                                                                           │ 2011 │ 5.0             │ Да          │
│ Snowflake, the White Gorilla (2011)                                                              │ 2011 │ 5.0             │ Да          │
│ Spellbound (2011)                                                                                │ 2011 │ 5.0             │ Да          │
│ Terri (2011)                                                                                     │ 2011 │ 5.0             │ Да          │
│ Your Highness (2011)                                                                             │ 2011 │ 5.0             │ Да          │
│ Big Top Scooby-Doo! (2012)                                                                       │ 2012 │ 5.0             │ Да          │
│ English Vinglish (2012)                                                                          │ 2012 │ 5.0             │ Да          │
│ Fantastic Fear of Everything, A (2012)                                                           │ 2012 │ 5.0             │ Да          │
│ Ghost Graduation (2012)                                                                          │ 2012 │ 5.0             │ Да          │
│ Hellbenders (2012)                                                                               │ 2012 │ 5.0             │ Да          │
│ Maria Bamford: The Special Special Special! (2012)                                               │ 2012 │ 0.5             │ Нет         │
│ On the Other Side of the Tracks (De l'autre côté du périph) (2012)                               │ 2012 │ 5.0             │ Да          │
│ Rust and Bone (De rouille et d'os) (2012)                                                        │ 2012 │ 0.5             │ Нет         │
│ Unicorn City (2012)                                                                              │ 2012 │ 5.0             │ Да          │
│ Chinese Puzzle (Casse-tête chinois) (2013)                                                       │ 2013 │ 5.0             │ Да          │
│ Craig Ferguson: I'm Here To Help (2013)                                                          │ 2013 │ 5.0             │ Да          │
│ Drinking Buddies (2013)                                                                          │ 2013 │ 0.5             │ Нет         │
│ Family, The (2013)                                                                               │ 2013 │ 5.0             │ Да          │
│ Filth (2013)                                                                                     │ 2013 │ 5.0             │ Да          │
│ Garden of Words, The (Koto no ha no niwa) (2013)                                                 │ 2013 │ 5.0             │ Да          │
│ Great Beauty, The (Grande Bellezza, La) (2013)                                                   │ 2013 │ 5.0             │ Да          │
│ Hunting Elephants (2013)                                                                         │ 2013 │ 5.0             │ Да          │
│ Saving Santa (2013)                                                                              │ 2013 │ 5.0             │ Да          │
│ Black Mirror: White Christmas (2014)                                                             │ 2014 │ 5.0             │ Да          │
│ Haunted House 2, A (2014)                                                                        │ 2014 │ 0.5             │ Нет         │
│ Love & Mercy (2014)                                                                              │ 2014 │ 5.0             │ Да          │
│ Mr. Peabody & Sherman (2014)                                                                     │ 2014 │ 5.0             │ Да          │
│ PK (2014)                                                                                        │ 2014 │ 5.0             │ Да          │
│ Predestination (2014)                                                                            │ 2014 │ 5.0             │ Да          │
│ The Raid 2: Berandal (2014)                                                                      │ 2014 │ 5.0             │ Да          │
│ The Salt of the Earth (2014)                                                                     │ 2014 │ 5.0             │ Да          │
│ Tom Segura: Completely Normal (2014)                                                             │ 2014 │ 5.0             │ Да          │
│ 10 Cent Pistol (2015)                                                                            │ 2015 │ 0.5             │ Нет         │
│ A Perfect Day (2015)                                                                             │ 2015 │ 5.0             │ Да          │
│ Bloodsucking Bastards (2015)                                                                     │ 2015 │ 5.0             │ Да          │
│ Buzzard (2015)                                                                                   │ 2015 │ 5.0             │ Да          │
│ Cosmic Scrat-tastrophe (2015)                                                                    │ 2015 │ 5.0             │ Да          │
│ Deathgasm (2015)                                                                                 │ 2015 │ 5.0             │ Да          │
│ Fifty Shades of Grey (2015)                                                                      │ 2015 │ 0.5             │ Нет         │
│ Human (2015)                                                                                     │ 2015 │ 5.0             │ Да          │
│ L.A. Slasher (2015)                                                                              │ 2015 │ 5.0             │ Да          │
│ Lumberjack Man (2015)                                                                            │ 2015 │ 5.0             │ Да          │
│ Ooops! Noah is Gone... (2015)                                                                    │ 2015 │ 5.0             │ Да          │
│ Sorrow (2015)                                                                                    │ 2015 │ 0.5             │ Нет         │
│ The Editor (2015)                                                                                │ 2015 │ 5.0             │ Да          │
│ The Gracefield Incident (2015)                                                                   │ 2015 │ 0.5             │ Нет         │
│ The Jinx: The Life and Deaths of Robert Durst (2015)                                             │ 2015 │ 5.0             │ Да          │
│ 13 Hours (2016)                                                                                  │ 2016 │ 5.0             │ Да          │
│ All Yours (2016)                                                                                 │ 2016 │ 5.0             │ Да          │
│ Bad Santa 2 (2016)                                                                               │ 2016 │ 0.5             │ Нет         │
│ Central Intelligence (2016)                                                                      │ 2016 │ 5.0             │ Да          │
│ Ice Age: The Great Egg-Scapade (2016)                                                            │ 2016 │ 5.0             │ Да          │
│ Satanic (2016)                                                                                   │ 2016 │ 0.5             │ Нет         │
│ Tom Segura: Mostly Stories (2016)                                                                │ 2016 │ 5.0             │ Да          │
│ Death Note (2017)                                                                                │ 2017 │ 0.5             │ Нет         │
│ Loving Vincent (2017)                                                                            │ 2017 │ 5.0             │ Да          │
└──────────────────────────────────────────────────────────────────────────────────────────────────┴──────┴─────────────────┴─────────────┘
 
4. Вычислить количество оценок и среднюю оценку, которую дали фильмам пользователи-мужчины в период с 2011 по 2014 год.
--------------------------------------------------
SELECT COUNT(*) as 'Количество оценок', AVG(r.rating) as 'Cредняя оценка' FROM ratings r JOIN users u ON r.user_id = u.id WHERE u.gender = 'male' AND strftime('%%Y', datetime(r.timestamp, 'unixepoch')) BETWEEN '2011' AND '2014'
┌───────────────────┬────────────────┐
│ Количество оценок │ Cредняя оценка │
├───────────────────┼────────────────┤
│ 0                 │                │
└───────────────────┴────────────────┘
 
5. Составить список фильмов с указанием средней оценки и количества пользователей, которые их оценили. Полученный список отсортировать по году выпуска и названиям фильмов. В списке оставить первые 20 записей.
--------------------------------------------------
SELECT m.title AS 'Название', m.year AS 'Год', AVG(r.rating) as 'Средний рейтинг', COUNT(DISTINCT r.user_id) as 'Коливество пользователей' FROM movies m LEFT JOIN ratings r ON m.id = r.movie_id GROUP BY m.id, m.title, m.year ORDER BY m.year, m.title LIMIT 20
┌─────────────────────────────────────────────────────────┬──────┬─────────────────┬──────────────────────────┐
│                        Название                         │ Год  │ Средний рейтинг │ Коливество пользователей │
├─────────────────────────────────────────────────────────┼──────┼─────────────────┼──────────────────────────┤
│ Babylon 5                                               │      │                 │ 0                        │
│ Black Mirror                                            │      │ 5.0             │ 1                        │
│ Cosmos                                                  │      │                 │ 0                        │
│ Death Note: Desu nôto (2006–2007)                       │      │ 5.0             │ 1                        │
│ Generation Iron 2                                       │      │ 3.5             │ 1                        │
│ Hyena Road                                              │      │                 │ 0                        │
│ Maria Bamford: Old Baby                                 │      │ 1.0             │ 1                        │
│ Moonlight                                               │      │                 │ 0                        │
│ Nocturnal Animals                                       │      │                 │ 0                        │
│ Paterson                                                │      │                 │ 0                        │
│ Ready Player One                                        │      │                 │ 0                        │
│ The Adventures of Sherlock Holmes and Doctor Watson     │      │ 5.0             │ 1                        │
│ The OA                                                  │      │                 │ 0                        │
│ Trip to the Moon, A (Voyage dans la lune, Le) (1902)    │ 1902 │ 4.0             │ 2                        │
│ The Great Train Robbery (1903)                          │ 1903 │                 │ 0                        │
│ The Electric Hotel (1908)                               │ 1908 │ 4.0             │ 1                        │
│ Birth of a Nation, The (1915)                           │ 1915 │                 │ 0                        │
│ 20,000 Leagues Under the Sea (1916)                     │ 1916 │ 4.0             │ 1                        │
│ Intolerance: Love's Struggle Throughout the Ages (1916) │ 1916 │                 │ 0                        │
│ Rink, The (1916)                                        │ 1916 │ 3.5             │ 1                        │
└─────────────────────────────────────────────────────────┴──────┴─────────────────┴──────────────────────────┘
 
6. Определить самый распространенный жанр фильма и количество фильмов в этом жанре. Отдельную таблицу для жанров не использовать, жанры нужно извлекать из таблицы movies.
--------------------------------------------------
WITH RECURSIVE split(genre, rest) AS (SELECT '', genres || '|' FROM movies UNION ALL SELECT substr(rest, 1, instr(rest, '|') - 1), substr(rest, instr(rest, '|') + 1) FROM split WHERE rest != ''), genre_counts AS (SELECT trim(genre) as genre, COUNT(*) as count FROM split WHERE genre != '' GROUP BY genre) SELECT genre AS 'Жанр', count AS 'Количество фильмов'  FROM genre_counts ORDER BY count DESC LIMIT 1
┌───────┬────────────────────┐
│ Жанр  │ Количество фильмов │
├───────┼────────────────────┤
│ Drama │ 4361               │
└───────┴────────────────────┘
 
7. Вывести список из 10 последних зарегистрированных пользователей в формате 'Фамилия Имя|Дата регистрации' (сначала фамилия, потом имя).
--------------------------------------------------
SELECT substr(name, instr(name, ' ') + 1) || ' ' || substr(name, 1, instr(name, ' ') - 1) || '|' || register_date AS 'Список последних регистраций' FROM users ORDER BY register_date DESC LIMIT 10
┌──────────────────────────────┐
│ Список последних регистраций │
├──────────────────────────────┤
│ Swaniawski Zula|2021-01-13   │
│ Reynolds Eda|2021-01-08      │
│ Herzog Filomena|2021-01-06   │
│ Spencer Meredith|2021-01-01  │
│ McCullough Lucius|2020-12-28 │
│ Bins Ross|2020-12-25         │
│ Prosacco Anita|2020-12-21    │
│ Bahringer Donna|2020-12-15   │
│ Sipes Clara|2020-12-14       │
│ Mante Kennith|2020-12-10     │
└──────────────────────────────┘
 
8. С помощью рекурсивного CTE определить, на какие дни недели приходился ваш день рождения в каждом году.
--------------------------------------------------
WITH RECURSIVE birthdays(year, date, day_of_week) AS (SELECT 2005, date('2005-09-03'), strftime('%%w', '2005-09-03') UNION ALL SELECT year + 1, date((year + 1) || '-09-03'), strftime('%%w', date((year + 1) || '-09-03')) FROM birthdays WHERE year < 2025) SELECT year, date, CASE day_of_week WHEN '0' THEN 'Воскресенье' WHEN '1' THEN 'Понедельник' WHEN '2' THEN 'Вторник' WHEN '3' THEN 'Среда' WHEN '4' THEN 'Четверг' WHEN '5' THEN 'Пятница' WHEN '6' THEN 'Суббота' END AS day_name FROM birthdays
┌──────┬────────────┬──────────┐
│ year │    date    │ day_name │
├──────┼────────────┼──────────┤
│ 2005 │ 2005-09-03 │          │
│ 2006 │ 2006-09-03 │          │
│ 2007 │ 2007-09-03 │          │
│ 2008 │ 2008-09-03 │          │
│ 2009 │ 2009-09-03 │          │
│ 2010 │ 2010-09-03 │          │
│ 2011 │ 2011-09-03 │          │
│ 2012 │ 2012-09-03 │          │
│ 2013 │ 2013-09-03 │          │
│ 2014 │ 2014-09-03 │          │
│ 2015 │ 2015-09-03 │          │
│ 2016 │ 2016-09-03 │          │
│ 2017 │ 2017-09-03 │          │
│ 2018 │ 2018-09-03 │          │
│ 2019 │ 2019-09-03 │          │
│ 2020 │ 2020-09-03 │          │
│ 2021 │ 2021-09-03 │          │
│ 2022 │ 2022-09-03 │          │
│ 2023 │ 2023-09-03 │          │
│ 2024 │ 2024-09-03 │          │
│ 2025 │ 2025-09-03 │          │
└──────┴────────────┴──────────┘
--------------------------------------------------
Total ok: 3
Total error: 0
--------------------------------------------------
/home/andrey/labs/DB/304_DB_Piganov_DM
Task04
Task from branch: Task04
Creation date: 10/31/2025 10:52:05
